# OrthoCare

> ê·¼ê±° ê¸°ë°˜ ê·¼ê³¨ê²©ê³„ ì§„ë‹¨ ë° ìš´ë™ ì¶”ì²œ AI ì‹œìŠ¤í…œ (V3 - ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜)
>
> í˜„ì¬ ì§€ì› ë¶€ìœ„: **ë¬´ë¦**, **ì–´ê¹¨**

---

## ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [V3 ì•„í‚¤í…ì²˜](#2-v3-ì•„í‚¤í…ì²˜---ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤-ë¶„ë¦¬)
3. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#3-í”„ë¡œì íŠ¸-êµ¬ì¡°)
4. [íŒŒì´í”„ë¼ì¸ ìƒì„¸](#4-íŒŒì´í”„ë¼ì¸-ìƒì„¸)
5. [ë°ì´í„° êµ¬ì¡°](#5-ë°ì´í„°-êµ¬ì¡°)
6. [ìš´ë™ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë° ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜](#6-ìš´ë™-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ-ë°-ì¶”ì²œ-ì•Œê³ ë¦¬ì¦˜)
7. [API ì—”ë“œí¬ì¸íŠ¸](#7-api-ì—”ë“œí¬ì¸íŠ¸-ìƒì„¸)
8. [ì‚¬í›„ í‰ê°€ ì‹œìŠ¤í…œ](#8-ì‚¬í›„-í‰ê°€-ì‹œìŠ¤í…œ-rpe-ê¸°ë°˜)
9. [ì„¤ì¹˜ ë° ì‹¤í–‰](#9-ì„¤ì¹˜-ë°-ì‹¤í–‰)
10. [í‰ê°€ ê²°ê³¼](#10-í‰ê°€-ê²°ê³¼)
11. [ê¸°ìˆ  ìŠ¤íƒ](#11-ê¸°ìˆ -ìŠ¤íƒ)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

OrthoCareëŠ” ìì—°ì–´ ì¦ìƒ ì…ë ¥ì„ ë¶„ì„í•˜ì—¬ ê·¼ê³¨ê²©ê³„ í†µì¦ì˜ ì›ì¸ì„ ì§„ë‹¨í•˜ê³ , ì˜í•™ ë…¼ë¬¸ ê·¼ê±°ì— ê¸°ë°˜í•œ ë§ì¶¤í˜• ìš´ë™ í”„ë¡œê·¸ë¨ì„ ì¶”ì²œí•˜ëŠ” AI ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥

- **Config-Driven Architecture**: ë¶€ìœ„ë³„(ë¬´ë¦/ì–´ê¹¨) ì„¤ì • íŒŒì¼ë¡œ ë™ì¼ íŒŒì´í”„ë¼ì¸, ë‹¤ë¥¸ ì§„ë‹¨ ë¡œì§ êµ¬í˜„
- **3-Layer ê·¼ê±° ê²€ìƒ‰**: ê²€ì¦ëœ ë…¼ë¬¸ â†’ OrthoBullets â†’ PubMed ìˆœìœ¼ë¡œ ì‹ ë¢°ë„ ë†’ì€ ê·¼ê±° ìš°ì„  ì œê³µ
- **ë²„í‚· ê¸°ë°˜ ì§„ë‹¨**: ë¶€ìœ„ë³„ 4ê°€ì§€ ì¹´í…Œê³ ë¦¬ë¡œ í†µì¦ ë¶„ë¥˜ (ë¬´ë¦: INF, ì–´ê¹¨: STF)
- **Anti-Hallucination**: LLMì´ ì‹¤ì œ ê²€ìƒ‰ëœ ë¬¸ì„œë§Œ ì¸ìš© (ê°€ì§œ ë…¼ë¬¸ ì¸ìš© ë°©ì§€)
- **ë§ì¶¤í˜• ìš´ë™ ì¶”ì²œ**: ì§„ë‹¨ ê²°ê³¼ì™€ ì‹ ì²´ ìƒíƒœì— ë”°ë¥¸ ìš´ë™ í”„ë¡œê·¸ë¨ ìƒì„±
- **ì‚¬í›„ í‰ê°€ ë°˜ì˜**: RPE ê¸°ë°˜ í”¼ë“œë°±ìœ¼ë¡œ ë‹¤ìŒ ì„¸ì…˜ ë‚œì´ë„ ìë™ ì¡°ì •

### ë²„í‚· ë¶„ë¥˜ ì²´ê³„

#### ë¬´ë¦ (Knee)

| ë²„í‚· | ì˜ë¯¸ | ì£¼ìš” íŠ¹ì§• | ì˜ˆì‹œ |
|------|------|----------|------|
| **OA** | Osteoarthritis (í‡´í–‰ì„±) | ë§Œì„±, ì§„í–‰ì„±, ì•„ì¹¨ ë»£ë»£í•¨ <30ë¶„ | ê³¨ê´€ì ˆì—¼, ì—°ê³¨ ë§ˆëª¨ |
| **OVR** | Overuse (ê³¼ì‚¬ìš©) | í™œë™ í›„ ì•…í™”, ë°˜ë³µì  ë™ì‘ | ëŸ¬ë„ˆìŠ¤ë‹ˆ, ìŠ¬ê°œëŒ€í‡´ ì¦í›„êµ° |
| **TRM** | Trauma (ì™¸ìƒ) | ê¸‰ì„± ë°œë³‘, ì™¸ìƒ ì´ë ¥ | ACL ì†ìƒ, ë°˜ì›”íŒ íŒŒì—´ |
| **INF** | Inflammatory (ì—¼ì¦) | ë¶“ê¸°, ì—´ê°, ì „ì‹  ì¦ìƒ | í™”ë†ì„± ê´€ì ˆì—¼, í†µí’ |

#### ì–´ê¹¨ (Shoulder)

| ë²„í‚· | ì˜ë¯¸ | ì£¼ìš” íŠ¹ì§• | ì˜ˆì‹œ |
|------|------|----------|------|
| **OA** | Osteoarthritis (í‡´í–‰ì„±) | 50ì„¸+, crepitus, ROM ê°ì†Œ | ê²¬ê´€ì ˆ ê³¨ê´€ì ˆì—¼, AC joint OA |
| **OVR** | Overuse (ê³¼ì‚¬ìš©) | Painful Arc (60-120ë„), overhead í™œë™ í›„ ì•…í™” | ì¶©ëŒì¦í›„êµ°, íšŒì „ê·¼ê°œ ê±´ì—¼ |
| **TRM** | Trauma (ì™¸ìƒ) | ê¸‰ì„± ì™¸ìƒ, í˜ ë¹ ì§, Drop Arm ì–‘ì„± | íšŒì „ê·¼ê°œ íŒŒì—´, AC joint ì†ìƒ |
| **STF** | Stiff/Frozen (ë™ê²°ê²¬) | ER ì œí•œ í˜„ì €, ì•¼ê°„í†µ, ì ì§„ì  ROM ê°ì†Œ | ë™ê²°ê²¬ (Adhesive Capsulitis) |

### í•µì‹¬ ì›ì¹™

- **Fail-fast**: ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¦‰ì‹œ ë“œëŸ¬ë‚´ê³  í•´ê²° (ì¡°ìš©í•œ í´ë°± ê¸ˆì§€)
- **ì‹¤ì œ ê·¼ê±° ì¸ìš©**: LLM ì‘ë‹µì—ì„œ ë²¡í„° DB ê²€ìƒ‰ ê²°ê³¼ë§Œ ì¸ìš© (hallucination ê¸ˆì§€)
- **Config-Driven**: ì½”ë“œ ìˆ˜ì • ì—†ì´ ë°ì´í„° íŒŒì¼ë§Œìœ¼ë¡œ ìƒˆ ë¶€ìœ„ ì¶”ê°€ ê°€ëŠ¥

---

## 2. V3 ì•„í‚¤í…ì²˜ - ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬

### ë¶„ë¦¬ ë°°ê²½

| ë¬¸ì œì  | í•´ê²°ì±… |
|--------|--------|
| ë²„í‚· ì¶”ë¡ (2ì£¼ 1íšŒ)ê³¼ ìš´ë™ ì¶”ì²œ(ë§¤ì¼)ì´ í†µí•© | ë…ë¦½ Docker ì»¨í…Œì´ë„ˆë¡œ ë¶„ë¦¬ |
| ë§¤ì¼ ìš´ë™ ì¶”ì²œ ì‹œ ë¶ˆí•„ìš”í•œ ë²„í‚· ì¶”ë¡  ë¹„ìš© | í•„ìš”í•  ë•Œë§Œ ë²„í‚· ì¶”ë¡  í˜¸ì¶œ |
| ë²¡í„° DB í†µí•©ìœ¼ë¡œ ê²€ìƒ‰ ì •í™•ë„ ì €í•˜ | ì§„ë‹¨ìš© / ìš´ë™ìš© ë²¡í„° DB ë¶„ë¦¬ |

### ì„œë¹„ìŠ¤ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OrthoCare V3 Architecture                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  bucket_inference    â”‚         â”‚ exercise_recommendation  â”‚
â”‚  (Docker :8001)      â”‚         â”‚  (Docker :8002)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ë²„í‚· ì¶”ë¡             â”‚         â”‚ â€¢ ìš´ë™ ì¶”ì²œ                 â”‚
â”‚ â€¢ 2ì£¼ 1íšŒ í˜¸ì¶œ         â”‚  â”€â”€â”€â”€â–¶  â”‚ â€¢ ë§¤ì¼ í˜¸ì¶œ                 â”‚
â”‚ â€¢ ë²¡í„°DB: diagnosis   â”‚         â”‚ â€¢ ë²¡í„°DB: exercise        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-----â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    shared/   â”‚
                   â”‚    ê³µí†µ ëª¨ë“ˆ   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ì„œë¹„ìŠ¤ | í¬íŠ¸ | ë¹ˆë„ | ë²¡í„° DB |
|--------|------|------|---------|
| **gateway** | 8000 | ì´ˆê¸° 1íšŒ | - (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜) |
| **bucket_inference** | 8001 | 2ì£¼ 1íšŒ | orthocare-diagnosis |
| **exercise_recommendation** | 8002 | ë§¤ì¼ | orthocare-exercise |

### í†µí•© Gateway ì•„í‚¤í…ì²˜ (V3.1)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Gateway Service (port 8000)                       â”‚
â”‚                    POST /api/v1/diagnose                                 â”‚
â”‚                    POST /api/v1/recommend-exercises                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ğŸ“± App Request (JSON)                                                 â”‚
â”‚   {demographics, body_parts, physical_score, options}                   â”‚
â”‚                              â†“                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚              OrchestrationService                        â”‚          â”‚
â”‚   â”‚                                                         â”‚          â”‚
â”‚   â”‚   Step 1: Bucket Inference Pipeline                     â”‚          â”‚
â”‚   â”‚           â”œâ”€ Weight Calculation                         â”‚          â”‚
â”‚   â”‚           â”œâ”€ Evidence Search (Pinecone)                 â”‚          â”‚
â”‚   â”‚           â””â”€ LLM Arbitration                            â”‚          â”‚
â”‚   â”‚                         â†“                               â”‚          â”‚
â”‚   â”‚   Step 2: Red Flag Check                                â”‚          â”‚
â”‚   â”‚           â”œâ”€ if red_flag â†’ skip exercises               â”‚          â”‚
â”‚   â”‚           â””â”€ else â†’ continue                            â”‚          â”‚
â”‚   â”‚                         â†“                               â”‚          â”‚
â”‚   â”‚   Step 3: Exercise Recommendation Pipeline              â”‚          â”‚
â”‚   â”‚           â”œâ”€ Bucket-based Filtering                     â”‚          â”‚
â”‚   â”‚           â”œâ”€ Personalization (context from Step 1)      â”‚          â”‚
â”‚   â”‚           â””â”€ LLM Recommendation                         â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                              â†“                                          â”‚
â”‚   ğŸ“¤ Unified Response                                                   â”‚
â”‚   {survey_data, diagnosis, exercise_plan, status}                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Gateway ì¥ì :**
- ì•±ì—ì„œ í•œ ë²ˆì˜ ìš”ì²­ìœ¼ë¡œ ë²„í‚· ì¶”ë¡  + ìš´ë™ ì¶”ì²œ ì™„ë£Œ
- Red Flag ê°ì§€ ì‹œ ìš´ë™ ì¶”ì²œ ìë™ ìŠ¤í‚µ
- ë²„í‚· ì¶”ë¡  ì»¨í…ìŠ¤íŠ¸ë¥¼ ìš´ë™ ì¶”ì²œì— ì „ë‹¬í•˜ì—¬ ê°œì¸í™” ê°•í™”
- ì‘ë‹µì— ì›ë³¸ ì„¤ë¬¸ í¬í•¨ â†’ ë°±ì—”ë“œ ì €ì¥ ìš©ì´

### LangGraph ë²„í‚· ì¶”ë¡  (V3.1 ì‹ ê·œ)

ë²„í‚· ì¶”ë¡  íŒŒì´í”„ë¼ì¸ì— LangGraphë¥¼ ì ìš©í•˜ì—¬ **32% ì„±ëŠ¥ í–¥ìƒ**:

```mermaid
graph TD;
    __start__([START]) --> load_config;
    load_config --> calculate_weights;
    calculate_weights --> build_search_query;
    build_search_query --> search_evidence;
    search_evidence --> merge_rankings;
    merge_rankings --> detect_discrepancy;
    detect_discrepancy --> check_red_flag;
    check_red_flag -.->|has_red_flag| red_flag_response;
    check_red_flag -.->|no_red_flag| llm_arbitration;
    llm_arbitration --> __end__([END]);
    red_flag_response --> __end__;
```

| í•­ëª© | ê¸°ì¡´ | LangGraph |
|------|------|-----------|
| ì„±ëŠ¥ | 10.4ì´ˆ | **7.1ì´ˆ** (-32%) |
| ìƒíƒœ ê´€ë¦¬ | ìˆ˜ë™ | ìë™ |
| ì‹œê°í™” | ì—†ìŒ | Mermaid/Studio |
| ì²´í¬í¬ì¸íŠ¸ | ì—†ìŒ | ë‚´ì¥ |

**ì‚¬ìš©ë²•:**
```python
# Gatewayì—ì„œ ìë™ ì‚¬ìš© (ê¸°ë³¸ê°’)
service = OrchestrationService()

# ê¸°ì¡´ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ í´ë°±
service = OrchestrationService(use_langgraph_bucket=False)
# ë˜ëŠ” í™˜ê²½ë³€ìˆ˜: USE_LANGGRAPH_BUCKET=false
```

> ìƒì„¸ ë¬¸ì„œ: [docs/architecture/langgraph.md](docs/architecture/langgraph.md)

### Config-Driven Architecture (ë‹¤ì¤‘ ë¶€ìœ„ ì§€ì›)

ë¶€ìœ„ë³„ ì„¤ì •ì´ ë°ì´í„° íŒŒì¼ë¡œ ê´€ë¦¬ë˜ì–´, ì½”ë“œ ìˆ˜ì • ì—†ì´ ìƒˆ ë¶€ìœ„ ì¶”ê°€ ê°€ëŠ¥:

```
body_part.code = "shoulder"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            BodyPartConfigLoader.load()               â”‚
â”‚                                                      â”‚
â”‚  1. config.json      â†’ display_name, version        â”‚
â”‚  2. buckets.json     â†’ bucket_order, bucket_info    â”‚
â”‚  3. weights.json     â†’ symptom weights              â”‚
â”‚  4. survey_mapping   â†’ question â†’ symptom mapping   â”‚
â”‚  5. red_flags.json   â†’ danger signals              â”‚
â”‚  6. prompts/*.txt    â†’ LLM prompt templates         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¬´ë¦ vs ì–´ê¹¨ ì°¨ì´ì :**

| í•­ëª© | ë¬´ë¦ (knee) | ì–´ê¹¨ (shoulder) |
|------|------------|-----------------|
| ë²„í‚· ìˆœì„œ | [OA, OVR, TRM, INF] | [OA, OVR, TRM, STF] |
| 4ë²ˆì§¸ ë²„í‚· | INF (Inflammatory) | STF (Frozen Shoulder) |
| í”„ë¡¬í”„íŠ¸ | ë¬´ë¦ ì „ë¬¸ì˜ ì—­í•  | ì–´ê¹¨ ì „ë¬¸ì˜ ì—­í•  |
| ì„¤ë¬¸ Q1-Q5 | ë¬´ë¦ ì „ìš© | ì–´ê¹¨ ì „ìš© |

### ë²¡í„° DB ë¶„ë¦¬

| ì¸ë±ìŠ¤ | ìš©ë„ | ì†ŒìŠ¤ |
|--------|------|------|
| `orthocare-diagnosis` | ë²„í‚· ì¶”ë¡  | verified_paper, orthobullets, pubmed |
| `orthocare-exercise` | ìš´ë™ ì¶”ì²œ | exercise |

---

## 3. í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Orthocare/
â”œâ”€â”€ bucket_inference/               # ë²„í‚· ì¶”ë¡  ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ main.py                     # FastAPI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸ (:8001)
â”‚   â”œâ”€â”€ config/settings.py          # ì„¤ì • (PINECONE_INDEX=orthocare-diagnosis)
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ input.py                # BucketInferenceInput
â”‚   â”‚   â””â”€â”€ output.py               # BucketInferenceOutput
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ weight_service.py       # ê°€ì¤‘ì¹˜ ê³„ì‚°
â”‚   â”‚   â”œâ”€â”€ evidence_search.py      # ë²¡í„° ê²€ìƒ‰ (ë…¼ë¬¸/ê°€ì´ë“œë¼ì¸)
â”‚   â”‚   â”œâ”€â”€ ranking_merger.py       # ë­í‚¹ í†µí•©
â”‚   â”‚   â””â”€â”€ bucket_arbitrator.py    # LLM ë²„í‚· ì¤‘ì¬
â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â””â”€â”€ inference_pipeline.py   # ë²„í‚· ì¶”ë¡  íŒŒì´í”„ë¼ì¸
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ exercise_recommendation/        # ìš´ë™ ì¶”ì²œ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ main.py                     # FastAPI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸ (:8002)
â”‚   â”œâ”€â”€ config/settings.py          # ì„¤ì • (PINECONE_INDEX=orthocare-exercise)
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ input.py                # ExerciseRecommendationInput
â”‚   â”‚   â”œâ”€â”€ output.py               # ExerciseRecommendationOutput
â”‚   â”‚   â””â”€â”€ assessment.py           # ì‚¬ì „/ì‚¬í›„ í‰ê°€ ëª¨ë¸
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ assessment_handler.py   # ì‚¬í›„ì„¤ë¬¸ ì²˜ë¦¬ (í•µì‹¬!)
â”‚   â”‚   â”œâ”€â”€ exercise_filter.py      # ë²„í‚· ê¸°ë°˜ í•„í„°ë§
â”‚   â”‚   â”œâ”€â”€ personalization.py      # ê°œì¸í™” ì¡°ì •
â”‚   â”‚   â””â”€â”€ recommender.py          # LLM ìš´ë™ ì¶”ì²œ
â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â””â”€â”€ recommendation_pipeline.py
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ shared/                         # ê³µìœ  ëª¨ë“ˆ
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ body_part_config.py     # BodyPartConfig, BodyPartConfigLoader
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ demographics.py         # Demographics ëª¨ë¸
â”‚   â”‚   â””â”€â”€ body_part.py            # BodyPartInput ëª¨ë¸
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logging.py
â”‚       â””â”€â”€ pinecone_client.py      # Pinecone ê³µí†µ í´ë¼ì´ì–¸íŠ¸
â”‚
â”œâ”€â”€ data/                           # ë°ì´í„°
â”‚   â”œâ”€â”€ medical/
â”‚   â”‚   â”œâ”€â”€ knee/                   # ë¬´ë¦ ì§„ë‹¨ ë°ì´í„°
â”‚   â”‚   â”‚   â”œâ”€â”€ config.json         # ë¶€ìœ„ ì„¤ì •
â”‚   â”‚   â”‚   â”œâ”€â”€ buckets.json        # ë²„í‚· ì •ì˜ (OA/OVR/TRM/INF)
â”‚   â”‚   â”‚   â”œâ”€â”€ weights.json        # ì¦ìƒ ê°€ì¤‘ì¹˜
â”‚   â”‚   â”‚   â”œâ”€â”€ survey_mapping.json # ì„¤ë¬¸ ë§¤í•‘
â”‚   â”‚   â”‚   â”œâ”€â”€ red_flags.json      # ë ˆë“œí”Œë˜ê·¸
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ arbitrator.txt  # LLM í”„ë¡¬í”„íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ papers/             # ë…¼ë¬¸ ë°ì´í„°
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ shoulder/               # ì–´ê¹¨ ì§„ë‹¨ ë°ì´í„°
â”‚   â”‚       â”œâ”€â”€ config.json         # ë¶€ìœ„ ì„¤ì •
â”‚   â”‚       â”œâ”€â”€ buckets.json        # ë²„í‚· ì •ì˜ (OA/OVR/TRM/STF)
â”‚   â”‚       â”œâ”€â”€ weights.json        # ì¦ìƒ ê°€ì¤‘ì¹˜
â”‚   â”‚       â”œâ”€â”€ survey_mapping.json # ì„¤ë¬¸ ë§¤í•‘
â”‚   â”‚       â”œâ”€â”€ red_flags.json      # ë ˆë“œí”Œë˜ê·¸
â”‚   â”‚       â””â”€â”€ prompts/
â”‚   â”‚           â””â”€â”€ arbitrator.txt  # LLM í”„ë¡¬í”„íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ exercise/
â”‚   â”‚   â””â”€â”€ knee/
â”‚   â”‚       â””â”€â”€ exercises.json      # ìš´ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬ (50ê°œ)
â”‚   â””â”€â”€ crawled/
â”‚       â””â”€â”€ orthobullets_cache.json # OrthoBullets êµìœ¡ ìë£Œ
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ index_diagnosis_db.py       # ì§„ë‹¨ìš© ë²¡í„° DB ì¸ë±ì‹±
â”‚   â””â”€â”€ index_exercise_db.py        # ìš´ë™ìš© ë²¡í„° DB ì¸ë±ì‹±
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ knee/                       # ë¬´ë¦ ê´€ë ¨ ë¬¸ì„œ
â”‚   â”‚   â”œâ”€â”€ form_v1.1.md            # ì„¤ë¬¸ ì–‘ì‹
â”‚   â”‚   â””â”€â”€ weights_v1.1.md         # ê°€ì¤‘ì¹˜ ì •ì˜
â”‚   â””â”€â”€ shoulder/                   # ì–´ê¹¨ ê´€ë ¨ ë¬¸ì„œ
â”‚       â””â”€â”€ diagnosis.md            # ì–´ê¹¨ ì§„ë‹¨ ì‹œìŠ¤í…œ ì„¤ëª…
â”‚
â””â”€â”€ docker-compose.yml              # Docker ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
```

---

## 4. íŒŒì´í”„ë¼ì¸ ìƒì„¸

### ì „ì²´ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: ì…ë ¥ ì²˜ë¦¬                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1-1. ì…ë ¥ ê²€ì¦                                                    â”‚
â”‚ 1-2. ë ˆë“œí”Œë˜ê·¸ ì²´í¬ (ë¶€ìœ„ë³„ ë£°)                                       â”‚
â”‚ 1-3. ì„¤ë¬¸ â†’ ì¦ìƒ ì½”ë“œ ë§¤í•‘ (í…Œì´ë¸” ê¸°ë°˜, LLM ì—†ìŒ)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: ì§„ë‹¨ (ë³‘ë ¬ ì²˜ë¦¬)                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ê²½ë¡œ A: ê°€ì¤‘ì¹˜     â”‚              â”‚ ê²½ë¡œ B: ë²¡í„°ê²€ìƒ‰    â”‚           â”‚
â”‚  â”‚ weights.json    â”‚              â”‚ ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                           â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ LLM Pass #1 â€” ë²„í‚· ê²€ì¦/ì •ë‹¹í™”                              â”‚    â”‚
â”‚  â”‚ â€¢ ë‘ ê²½ë¡œ ê²°ê³¼ ë¹„êµ, ë¶ˆì¼ì¹˜ ê°ì§€ ì‹œ ì¬ê²€í†                         â”‚    â”‚
â”‚  â”‚ â€¢ Output: ìµœì¢… ë²„í‚· + ì‹ ë¢°ë„ + ê·¼ê±° ì„¤ëª…                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: ìš´ë™ ì²˜ë°©                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3-1. ë²„í‚· ê¸°ë°˜ ìš´ë™ í•„í„°ë§                                           â”‚
â”‚ 3-2. LLM Pass #2 â€” ìš´ë™ ì¶”ì²œ                                      â”‚
â”‚      Input: ë²„í‚· + ê·¼ê±° + ì‹ ì²´ì ìˆ˜ + NRS + ê¸ˆê¸°ì¡°ê±´                    â”‚
â”‚      Output: ìš´ë™ 5~7ê°œ + ì¶”ì²œ ì´ìœ                                  â”‚
â”‚ 3-3. ë£¨í‹´ êµ¬ì„± (ìˆœì„œ, ì„¸íŠ¸/ë ™/íœ´ì‹)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë³‘ë ¬ ê²€ìƒ‰ ì „ëµ (ê°€ì¤‘ì¹˜ + ë²¡í„°)

**ë¬¸ì œ**: ê°€ì¤‘ì¹˜ë§Œ ë¯¿ìœ¼ë©´ ì˜¤ë¥˜ ì‹œ ì „ì²´ê°€ í‹€ì–´ì§
**í•´ê²°**: ë‘ ê²½ë¡œ ë³‘ë ¬ ì‹¤í–‰ â†’ LLMì´ ë¹„êµ íŒë‹¨

```python
# ê²½ë¡œ A: ê·œì¹™ ê¸°ë°˜
weight_scores = {"OA": 15, "OVR": 8, "TRM": 3, "INF": 2}

# ê²½ë¡œ B: ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰
search_results = [
    {"bucket": "OA", "count": 5},
    {"bucket": "TRM", "count": 3},  # ê°€ì¤‘ì¹˜ì™€ ë¶ˆì¼ì¹˜!
]

# LLMì— ë‘˜ ë‹¤ ì „ë‹¬ â†’ ë¶ˆì¼ì¹˜ ê°ì§€ ì‹œ ì¬ê²€í†  í›„ ìµœì¢… ê²°ì •
```

### ê·¼ê±° ê²€ìƒ‰ ê³„ì¸µ (Evidence Layers)

| Layer | ì†ŒìŠ¤ íƒ€ì… | ì‹ ë¢°ë„ |
|-------|----------|--------|
| **1** | verified_paper | ìµœìƒ |
| **2** | orthobullets | ìƒ |
| **3** | pubmed | ì¤‘ (ë¯¸ê²€ì¦) |

**í˜„ì¬ ë²¡í„° DB í˜„í™©**:
```
ì´ ë²¡í„° ìˆ˜: 875ê°œ
â”œâ”€â”€ verified_paper: 47ê°œ (ê²€ì¦ëœ ë…¼ë¬¸ ì²­í¬)
â”œâ”€â”€ pubmed: 40ê°œ (PubMed ë…¼ë¬¸ ì²­í¬)
â”œâ”€â”€ orthobullets: 5ê°œ (OrthoBullets êµìœ¡ ìë£Œ)
â””â”€â”€ exercise: 50ê°œ (ìš´ë™ ë°ì´í„°)
```

### LLM ì¸ìš© ê·œì¹™ (Anti-Hallucination)

```
## ì¸ìš© ê·œì¹™ (ë§¤ìš° ì¤‘ìš”)
- ë²¡í„° DB ê²€ìƒ‰ ê²°ê³¼ì— ìˆëŠ” ë¬¸ì„œë§Œ ì¸ìš©
- ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë…¼ë¬¸/ê°€ì´ë“œë¼ì¸ ìƒì„± ê¸ˆì§€
- ì¸ìš© í˜•ì‹: "ì œëª©" [source] - "ê´€ë ¨ ë‚´ìš©"
```

---

## 5. ë°ì´í„° êµ¬ì¡°

### ë…¼ë¬¸ ë©”íƒ€ë°ì´í„° (`paper_metadata.json`)

```json
{
  "papers": {
    "duncan2008": {
      "title": "Pain and Function in Knee Osteoarthritis (Duncan 2008)",
      "buckets": ["OA"],
      "source_type": "verified_paper",
      "evidence_level": "Level II",
      "year": 2008
    }
  }
}
```

### OrthoBullets ìºì‹œ (`orthobullets_cache.json`)

| í† í”½ | ë²„í‚· | ë‚´ìš© |
|------|------|------|
| knee_oa_overview | OA | ë¬´ë¦ ê³¨ê´€ì ˆì—¼ |
| acl_injury | TRM | ì „ë°©ì‹­ìì¸ëŒ€ ì†ìƒ |
| meniscus_tear | TRM | ë°˜ì›”íŒ íŒŒì—´ |
| patellofemoral_syndrome | OVR | ìŠ¬ê°œëŒ€í‡´ ì¦í›„êµ° |
| septic_arthritis | INF | í™”ë†ì„± ê´€ì ˆì—¼ |

### ë²¡í„° DB ë©”íƒ€ë°ì´í„° ìŠ¤í‚¤ë§ˆ

```python
metadata = {
    "body_part": "knee",           # í•„ìˆ˜
    "source": "verified_paper",    # verified_paper, orthobullets, pubmed, exercise
    "bucket": "OA,TRM",            # ë²„í‚· íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)
    "title": "ë…¼ë¬¸ ì œëª©",
    "text": "ì²­í¬ í…ìŠ¤íŠ¸ ë‚´ìš©...",
    "year": 2008,
    "url": "https://..."
}
```

---

## 6. ìš´ë™ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë° ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜

### 6.1 ìš´ë™ ë°ì´í„° ìŠ¤í‚¤ë§ˆ

ìš´ë™ ë°ì´í„°ëŠ” `data/exercise/{body_part}/exercises.json`ì— ì €ì¥ë©ë‹ˆë‹¤.

#### í˜„ì¬ êµ¬í˜„ëœ í•„ë“œ

```json
{
  "E01": {
    "name_en": "Heel Slide",
    "name_kr": "í ìŠ¬ë¼ì´ë“œ",
    "difficulty": "low",
    "diagnosis_tags": ["INF", "TRM"],
    "function_tags": ["Mobility"],
    "target_muscles": ["í–„ìŠ¤íŠ¸ë§", "ëŒ€í‡´ì‚¬ë‘ê·¼"],
    "sets": 2,
    "reps": "15íšŒ",
    "rest": "30ì´ˆ",
    "description": "ëˆ„ì›Œì„œ ë°œê¿ˆì¹˜ë¥¼ ì—‰ë©ì´ ìª½ìœ¼ë¡œ ë¯¸ë„ëŸ¬ëœ¨ë ¤ ë¬´ë¦ ê°€ë™ë²”ìœ„ íšŒë³µ",
    "youtube": "https://youtu.be/Er-Fl_poWDk"
  }
}
```

#### í•„ë“œ ìƒì„¸ ì„¤ëª…

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì„ìƒì  ê·¼ê±° |
|------|------|------|------|------------|
| **code** (key) | string | âœ“ | ìš´ë™ ê³ ìœ  ID (ì˜ˆ: E01, E02) | AIê°€ ìš´ë™ì„ í˜¸ì¶œí•˜ê³  ì¶”ì í•˜ëŠ” ê¸°ì¤€ |
| **name_en** | string | âœ“ | ì˜ë¬¸ ìš´ë™ëª… | ì „ë¬¸ê°€/íŠ¸ë ˆì´ë„ˆ ê°„ êµ­ì œ í‘œì¤€ ëª…ì¹­ |
| **name_kr** | string | âœ“ | í•œê¸€ ìš´ë™ëª… | í™˜ìê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ ëª…ì¹­ |
| **difficulty** | string | âœ“ | ë‚œì´ë„ ë“±ê¸‰ | ë¶€í•˜ëŸ‰, ê°€ë™ë²”ìœ„, ê·¼ë ¥ ìš”êµ¬ë„ ê¸°ë°˜ |
| **diagnosis_tags** | array | âœ“ | ì§ˆí™˜ ë¶„ë¥˜ í‚¤ | ìš´ë™ ì¶”ì²œì˜ 1ì°¨ í•„í„° ì—­í•  |
| **function_tags** | array | âœ“ | ê¸°ëŠ¥ ë¶„ë¥˜ í‚¤ | í”„ë¡œí† ì½œ ì„¤ê³„ì˜ í•µì‹¬ ê¸°ì¤€ |
| **target_muscles** | array | âœ“ | ì£¼ë™ê·¼ ëª©ë¡ | ì•½í™” ê·¼ìœ¡ ì§ì ‘ íƒ€ê²ŸíŒ… |
| **sets** | int | âœ“ | ì„¸íŠ¸ ìˆ˜ | ë¶€í•˜ ìš©ëŸ‰(Volume) ê²°ì • |
| **reps** | string | âœ“ | ë°˜ë³µ íšŸìˆ˜ ë˜ëŠ” ì‹œê°„ | ê·¼ë ¥/ì§€êµ¬ë ¥/ì‹ ê²½í™œì„± íŒ¨í„´ ì •ëŸ‰í™” |
| **rest** | string | âœ“ | ì„¸íŠ¸ ê°„ íœ´ì‹ | ê·¼ì§€êµ¬ë ¥/ê·¼ë¹„ëŒ€/ì‹ ê²½í™œì„± ëª©ì ë³„ ì¡°ì ˆ |
| **description** | string | âœ“ | ìš´ë™ ìˆ˜í–‰ë²• ì„¤ëª… | ì •í™•í•œ ìì„¸ë¡œ ë¶€ìƒ ì˜ˆë°© |
| **youtube** | string | | ì˜ìƒ ë§í¬ | ì‹œê°ì  í•™ìŠµ ìë£Œ |

#### ë‚œì´ë„ ë“±ê¸‰ ì²´ê³„ (Difficulty)

| ë“±ê¸‰ | ì½”ë“œ | ê¸°ì¤€ | ëŒ€ìƒ í™˜ì |
|------|------|------|----------|
| **ê¸°ì´ˆ ë‹¨ê³„** | `low` | ëˆ„ìš´/ì•‰ì€ ìì„¸, ìµœì†Œ ê´€ì ˆ ë¶€í•˜, ê¸°ë³¸ ROM | ê¸‰ì„±ê¸°, ê³ ë ¹ì, ì‹ ì²´ì ìˆ˜ D |
| **í‘œì¤€ ë‹¨ê³„** | `medium` | ì¤‘ê°„ ê´€ì ˆ ë¶€í•˜, í‘œì¤€ ROM, ë¶€ë¶„ ì²´ì¤‘ì§€ì§€ | ì•„ê¸‰ì„±ê¸°, ì‹ ì²´ì ìˆ˜ C-B |
| **ê°•í™” ë‹¨ê³„** | `high` | ë†’ì€ ê´€ì ˆ ë¶€í•˜, ì „ì²´ ì²´ì¤‘ì§€ì§€, ê¸°ëŠ¥ì  ë™ì‘ | íšŒë³µê¸°, ì‹ ì²´ì ìˆ˜ B-A |

> í–¥í›„ `very_high` (ì‹¬í™” ë‹¨ê³„) ì¶”ê°€ ì˜ˆì •: ìŠ¤í¬ì¸  ë³µê·€ ëª©ì , í­ë°œì  ë™ì‘ í¬í•¨

#### ì§ˆí™˜ ë¶„ë¥˜ í‚¤ (Diagnosis Tags)

| íƒœê·¸ | ì˜ë¯¸ | ì„¤ëª… | ìš´ë™ íŠ¹ì„± |
|------|------|------|----------|
| **OA** | Osteoarthritis | í‡´í–‰ì„± ê´€ì ˆì—¼ | ì €ì¶©ê²©, ê´€ì ˆ ë³´í˜¸, ê·¼ë ¥ ìœ ì§€ |
| **OVR** | Overuse | ê³¼ì‚¬ìš© ì¦í›„êµ° | ì ì§„ì  ê°•í™”, ìƒì—­í•™ êµì • |
| **TRM** | Trauma | ì™¸ìƒì„± ì†ìƒ | ROM íšŒë³µ, ì•ˆì •ì„±, ë‹¨ê³„ì  ì§„í–‰ |
| **INF** | Inflammatory | ì—¼ì¦ì„± ì§ˆí™˜ | ì €ê°•ë„ ê°€ë™ì„±, ìˆœí™˜ ì´‰ì§„ |

#### ê¸°ëŠ¥ ë¶„ë¥˜ í‚¤ (Function Tags)

| íƒœê·¸ | ëª©ì  | ë£¨í‹´ ìˆœì„œ | ëŒ€í‘œ ìš´ë™ |
|------|------|----------|----------|
| **Mobility** | ê´€ì ˆ ê°€ë™ë²”ìœ„ íšŒë³µ | 1 (ì¤€ë¹„) | í ìŠ¬ë¼ì´ë“œ, ë°œëª© íŒí”„ |
| **Stretching** | ê·¼ìœ¡/ì—°ë¶€ì¡°ì§ ìœ ì—°ì„± | 2 (ì¤€ë¹„) | ì¢…ì•„ë¦¬ ìŠ¤íŠ¸ë ˆì¹­, í–„ìŠ¤íŠ¸ë§ ìŠ¤íŠ¸ë ˆì¹­ |
| **Strengthening** | ê·¼ë ¥ ê°•í™” | 3 (ë³¸ìš´ë™) | ìŠ¤ì¿¼íŠ¸, ë¸Œë¦¬ì§€, ë ˆê·¸í”„ë ˆìŠ¤ |
| **Stability** | ê´€ì ˆ ì•ˆì •ì„± | 4 (ë§ˆë¬´ë¦¬) | í´ë¨ì‰˜, ì½”ì–´ ìš´ë™ |
| **Balance** | ê· í˜• ë° ê³ ìœ ìˆ˜ìš©ê°ê° | 5 (ë§ˆë¬´ë¦¬) | í•œ ë°œ ì„œê¸°, BOSU ìš´ë™ |
| **Endurance** | ê·¼ì§€êµ¬ë ¥ | 3-4 | ë²½ì•‰ê¸°, ë°˜ë³µ ìŠ¤í… |
| **Circulation** | í˜ˆì•¡ìˆœí™˜ ì´‰ì§„ | 1 | ë°œëª© íŒí”„, ê²½ë¯¸í•œ ì›€ì§ì„ |

### 6.2 í™•ì¥ ì˜ˆì • í•„ë“œ (V2 ìŠ¤í‚¤ë§ˆ)

ì„ìƒì  ì •í™•ë„ í–¥ìƒì„ ìœ„í•´ ë‹¤ìŒ í•„ë“œ ì¶”ê°€ ì˜ˆì •:

```json
{
  "E01": {
    "...ê¸°ì¡´ í•„ë“œ...": "...",

    "joint_loading": "very_low",
    "movement_pattern": "mobility",
    "required_rom": "small",
    "kinetic_chain": "OKC",
    "agonist": ["í–„ìŠ¤íŠ¸ë§", "ëŒ€í‡´ì‚¬ë‘ê·¼"],
    "antagonist": ["ê³ ê´€ì ˆ êµ´ê³¡ê·¼"],
    "synergist": ["ë³µì§ê·¼", "ì¤‘ë‘”ê·¼"]
  }
}
```

#### ê´€ì ˆ ë¶€í•˜ ìˆ˜ì¤€ (Joint Loading Level)

| ë“±ê¸‰ | ì½”ë“œ | ì„¤ëª… | ì ì‘ì¦ |
|------|------|------|--------|
| **ë§¤ìš° ë‚®ìŒ** | `very_low` | ë¹„ì²´ì¤‘ë¶€í•˜, ì§€ì§€ë©´ ìœ„ | ê¸‰ì„±ê¸°, NRS 7+ |
| **ë‚®ìŒ** | `low` | ë¶€ë¶„ ì²´ì¤‘ë¶€í•˜, ë³´ì¡°ê¸°êµ¬ | ì•„ê¸‰ì„±ê¸°, NRS 5-6 |
| **ì¤‘ê°„** | `moderate` | ì „ì²´ ì²´ì¤‘ë¶€í•˜, ì •ì  ë™ì‘ | íšŒë³µê¸°, NRS 3-4 |
| **ë†’ìŒ** | `high` | ë™ì  ì²´ì¤‘ë¶€í•˜, ì¶©ê²© í¬í•¨ | ê¸°ëŠ¥ì  ë‹¨ê³„, NRS 0-2 |

> **ì„ìƒì  ì´ìœ **: í†µì¦ ë‹¨ê³„/ì¬í™œ ë‹¨ê³„ì— ë§ëŠ” ìš´ë™ ì„ íƒì„ ì •í™•íˆ í•˜ê¸° ìœ„í•¨

#### ì›€ì§ì„ íŒ¨í„´ (Movement Pattern Type)

| íŒ¨í„´ | ì½”ë“œ | ëŒ€í‘œ ìš´ë™ | ì£¼ìš” ê·¼ìœ¡ |
|------|------|----------|----------|
| **ìŠ¤ì¿¼íŠ¸** | `squat` | ë¯¸ë‹ˆìŠ¤ì¿¼íŠ¸, ë²½ì•‰ê¸° | ëŒ€í‡´ì‚¬ë‘ê·¼, ë‘”ê·¼ |
| **ëŸ°ì§€** | `lunge` | ì „ë°©ëŸ°ì§€, ì¸¡ë©´ëŸ°ì§€ | ëŒ€í‡´ì‚¬ë‘ê·¼, ê³ ê´€ì ˆêµ´ê³¡ê·¼ |
| **í™íŒì§€/ë¸Œë¦¬ì§€** | `hip_hinge` | ë¸Œë¦¬ì§€, ë°ë“œë¦¬í”„íŠ¸ | ë‘”ê·¼, í–„ìŠ¤íŠ¸ë§ |
| **ìŠ¤í…/ë³´í–‰** | `step_gait` | ìŠ¤í…ì—…, ë³´í–‰í›ˆë ¨ | í•˜ì§€ ì „ì²´ |
| **ë°¸ëŸ°ìŠ¤** | `balance` | í•œ ë°œ ì„œê¸°, BOSU | ê³ ìœ ìˆ˜ìš©ê°ê° |
| **ì½”ì–´** | `core` | í”Œë­í¬, ë°ë“œë²„ê·¸ | ë³µê·¼, ìš”ì¶”ë‹¤ì—´ê·¼ |
| **ê°€ë™ì„±** | `mobility` | íìŠ¬ë¼ì´ë“œ, ROM ìš´ë™ | ê´€ì ˆë‚­, ì¸ëŒ€ |

> **ì„ìƒì  ì´ìœ **: íŒ¨í„´ ë‹¨ìœ„ ì²˜ë°©ì´ ê·¼ìœ¡ ë‹¨ìœ„ë³´ë‹¤ ê¸°ëŠ¥ íšŒë³µì— ë” íš¨ê³¼ì 

#### í•„ìš” ê°€ë™ë²”ìœ„ (Required ROM)

| ë“±ê¸‰ | ì½”ë“œ | ë¬´ë¦ ROM ì˜ˆì‹œ | ì ì‘ì¦ |
|------|------|-------------|--------|
| **ì†Œ** | `small` | 0-45Â° | ROM ì œí•œ í™˜ì, ì´ˆê¸° ì¬í™œ |
| **ì¤‘** | `medium` | 0-90Â° | ë¶€ë¶„ ROM íšŒë³µ í™˜ì |
| **ëŒ€** | `full` | 0-120Â°+ | ì „ì²´ ROM íšŒë³µ í™˜ì |

#### ìš´ë™ ì‚¬ìŠ¬ íƒ€ì… (Kinetic Chain)

| íƒ€ì… | ì½”ë“œ | íŠ¹ì„± | ì ì‘ì¦ |
|------|------|------|--------|
| **OKC** | `OKC` | ì›ìœ„ë¶€ ììœ  (ë ˆê·¸ìµìŠ¤í…ì…˜) | íŠ¹ì • ê·¼ìœ¡ ê²©ë¦¬ ê°•í™” |
| **CKC** | `CKC` | ì›ìœ„ë¶€ ê³ ì • (ìŠ¤ì¿¼íŠ¸) | ê´€ì ˆ ì•ˆì •ì„±, ê¸°ëŠ¥ì  ì›€ì§ì„ |

> **ì„ìƒ ê·¼ê±°**: CKCëŠ” ê´€ì ˆ ì•ˆì •ì„±â†‘, OKCëŠ” íŠ¹ì • ê·¼ìœ¡ ê²©ë¦¬ ê°•í™”â†‘

#### ê·¼ìœ¡ ë¶„ë¥˜ ì²´ê³„

| ë¶„ë¥˜ | ì„¤ëª… | ì„ìƒì  ì¤‘ìš”ë„ |
|------|------|--------------|
| **ì£¼ë™ê·¼ (Agonist)** | ì£¼ë¡œ í˜ì„ ìƒì‚°í•˜ëŠ” ê·¼ìœ¡ | ì•½í™” ê·¼ìœ¡ ì§ì ‘ íƒ€ê²ŸíŒ… |
| **ê¸¸í•­ê·¼ (Antagonist)** | ì£¼ë™ê·¼ ë°˜ëŒ€ ì‘ìš© ê·¼ìœ¡ | íƒ€ì´íŠ¸â†’ROM ì œí•œâ†’í†µì¦ ì¦ê°€ |
| **í˜‘ë™ê·¼ (Synergist)** | ë³´ì¡°/ì•ˆì •í™” ì—­í•  ê·¼ìœ¡ | ìš´ë™ íŒ¨í„´ ì •ìƒí™”, ê¸°ëŠ¥ ê°œì„  |

### 6.3 ìš´ë™ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜

#### ì „ì²´ íŒŒì´í”„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì…ë ¥ ê²€ì¦ ë° ì „ì²˜ë¦¬                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ë²„í‚· ìœ íš¨ì„± ê²€ì¦ (OA/OVR/TRM/INF)                             â”‚
â”‚ â€¢ ë³µìˆ˜ ë²„í‚· ì²˜ë¦¬: "TRM|OA" â†’ ì²« ë²ˆì§¸ ìœ íš¨ ë²„í‚· ì„ íƒ             â”‚
â”‚ â€¢ ì‹ ì²´ ì ìˆ˜ ë ˆë²¨ í™•ì¸ (A/B/C/D)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. í›„ë³´ ìš´ë™ í•„í„°ë§ (ExerciseFilter)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ë²„í‚· ë§¤ì¹­: diagnosis_tagsì— ë²„í‚· í¬í•¨ ì—¬ë¶€                    â”‚
â”‚ â€¢ ë‚œì´ë„ í•„í„°ë§: ì‹ ì²´ ì ìˆ˜ + NRS ê¸°ë°˜ í—ˆìš© ë‚œì´ë„ ê²°ì •          â”‚
â”‚   - ì‹ ì²´ Lv A: low, medium, high í—ˆìš©                          â”‚
â”‚   - ì‹ ì²´ Lv D: lowë§Œ í—ˆìš©                                       â”‚
â”‚   - NRS â‰¥ 7: lowë§Œ í—ˆìš©                                        â”‚
â”‚   - NRS 4-6: high ì œì™¸                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ê°œì¸í™” ì¡°ì • (PersonalizationService)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ë‚˜ì´ ê¸°ë°˜ ì¡°ì •                                                â”‚
â”‚   - 65ì„¸+: ì„¸íŠ¸ -1, íœ´ì‹ +15ì´ˆ                                  â”‚
â”‚   - 50-64ì„¸: íœ´ì‹ +10ì´ˆ                                         â”‚
â”‚ â€¢ BMI ê¸°ë°˜ ì¡°ì •                                                 â”‚
â”‚   - BMI 30+: ê·¼ë ¥ìš´ë™ ì„¸íŠ¸ -1, íœ´ì‹ +15ì´ˆ                       â”‚
â”‚   - BMI 25-29: íœ´ì‹ +5ì´ˆ                                        â”‚
â”‚ â€¢ í†µì¦ ê¸°ë°˜ ì¡°ì •                                                â”‚
â”‚   - NRS 7+: ì„¸íŠ¸ -1, ë°˜ë³µ -3íšŒ                                  â”‚
â”‚   - NRS 4-6: ë°˜ë³µ -2íšŒ                                          â”‚
â”‚ â€¢ ìš°ì„ ìˆœìœ„ ë¶€ìŠ¤íŠ¸                                               â”‚
â”‚   - ê³ ë ¹ì: ê· í˜•/ì•ˆì •ì„± ìš´ë™ +0.15                              â”‚
â”‚   - ë¹„ë§Œ: ê°€ë™ì„±/ìŠ¤íŠ¸ë ˆì¹­ +0.1                                  â”‚
â”‚   - ê³ í†µì¦: ê°€ë™ì„± +0.15                                        â”‚
â”‚   - ì Šì€ì¸µ+ì €í†µì¦: ê·¼ë ¥ +0.1                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LLM ê¸°ë°˜ ìµœì¢… ì„ íƒ (ExerciseRecommender)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ í™˜ì í”„ë¡œí•„ ë¶„ì„ â†’ LLM í”„ë¡¬í”„íŠ¸ì— í¬í•¨                        â”‚
â”‚ â€¢ í›„ë³´ ìš´ë™ ì •ë³´ + ê°œì¸í™” ê°€ì´ë“œ ì „ë‹¬                           â”‚
â”‚ â€¢ ì„ íƒ ê¸°ì¤€:                                                    â”‚
â”‚   1. í™˜ì íŠ¹ì„± ë§ì¶¤ (ë‚˜ì´/BMI/í†µì¦)                              â”‚
â”‚   2. ê¸°ëŠ¥ ê· í˜• (ê°€ë™ì„±, ê·¼ë ¥, ì•ˆì •ì„±)                           â”‚
â”‚   3. ë‹¤ì–‘ì„± (ê°™ì€ ê¸°ëŠ¥ ìš´ë™ë§Œ ì„ íƒ ë°©ì§€)                        â”‚
â”‚   4. ì§„í–‰ì„± (ì‰¬ìš´ â†’ ì–´ë ¤ìš´ ìˆœì„œ)                                â”‚
â”‚ â€¢ ì¶œë ¥: 5-7ê°œ ìš´ë™ + ì¶”ì²œ ì´ìœ  + ì í•©ë„ ì ìˆ˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ìš´ë™ ìˆœì„œ ê²°ì • (get_exercise_order)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ìˆœì„œ ì›ì¹™:                                                      â”‚
â”‚ 1. ì¤€ë¹„ ìš´ë™ (Mobility, Stretching) â†’ ë¨¼ì €                      â”‚
â”‚ 2. ë³¸ ìš´ë™ (Strengthening) â†’ ì¤‘ê°„                               â”‚
â”‚ 3. ë§ˆë¬´ë¦¬ (Balance, Stability) â†’ ë§ˆì§€ë§‰                         â”‚
â”‚ 4. ê°™ì€ ì¹´í…Œê³ ë¦¬ ë‚´ ë‚œì´ë„ ì˜¤ë¦„ì°¨ìˆœ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë‚œì´ë„ í—ˆìš© ë§¤íŠ¸ë¦­ìŠ¤

| ì‹ ì²´ ë ˆë²¨ | NRS 0-3 | NRS 4-6 | NRS 7+ |
|----------|---------|---------|--------|
| **A** | low, medium, high | low, medium | low |
| **B** | low, medium, high | low, medium | low |
| **C** | low, medium | low, medium | low |
| **D** | low | low | low |

#### ê°œì¸í™” ì¡°ì • ìƒì„¸

```python
# ë‚˜ì´ ê¸°ë°˜ ì¡°ì •
if age >= 65:
    sets = max(1, sets - 1)
    rest = rest + 15ì´ˆ
    # ê· í˜•/ì•ˆì •ì„± ìš´ë™ ìš°ì„ ìˆœìœ„ +0.15

# BMI ê¸°ë°˜ ì¡°ì •
if bmi >= 30:
    if "Strengthening" in function_tags:
        sets = max(1, sets - 1)
    rest = rest + 15ì´ˆ
    # ê°€ë™ì„±/ìŠ¤íŠ¸ë ˆì¹­ ìš´ë™ ìš°ì„ ìˆœìœ„ +0.1

# í†µì¦ ê¸°ë°˜ ì¡°ì •
if nrs >= 7:
    sets = max(1, sets - 1)
    reps = max(5, reps - 3)
    # ê°€ë™ì„± ìš´ë™ ìš°ì„ ìˆœìœ„ +0.15
```

#### ì‚¬í›„ ì„¤ë¬¸ ê¸°ë°˜ ì¡°ì •

3ì„¸ì…˜ RPE í•©ê³„ì— ë”°ë¥¸ ë‹¤ìŒ ì„¸ì…˜ ì¡°ì •:

| RPE í•©ê³„ | í•´ì„ | ì¡°ì • |
|----------|------|------|
| â‰¤ 6 | ë„ˆë¬´ ì‰¬ì›€ | ë‚œì´ë„ +1, ì„¸íŠ¸ +1, ë°˜ë³µ +2 |
| 7-11 | ì ì • | ìœ ì§€ |
| â‰¥ 12 | ë„ˆë¬´ í˜ë“¦ | ë‚œì´ë„ -1, ì„¸íŠ¸ -1, ë°˜ë³µ -2 |

### 6.4 ë²¡í„° ê²€ìƒ‰ ê¸°ë°˜ ìš´ë™ ê²€ìƒ‰

#### ìš´ë™ìš© ë²¡í„° DB (orthocare-exercise)

```python
# ìš´ë™ ë²¡í„° ë©”íƒ€ë°ì´í„°
metadata = {
    "id": "E01",
    "body_part": "knee",
    "source": "exercise",
    "bucket": "INF,TRM",           # ì‰¼í‘œ êµ¬ë¶„ ë³µìˆ˜ ë²„í‚·
    "name_kr": "í ìŠ¬ë¼ì´ë“œ",
    "name_en": "Heel Slide",
    "difficulty": "low",
    "function_tags": "Mobility",
    "target_muscles": "í–„ìŠ¤íŠ¸ë§,ëŒ€í‡´ì‚¬ë‘ê·¼"
}
```

#### ì¦ìƒ ê¸°ë°˜ ê²€ìƒ‰ ì¿¼ë¦¬ ìƒì„±

```python
def _build_query(symptoms, body_part, bucket, demographics):
    parts = [
        f"ë¶€ìœ„: {body_part}",
        f"ë²„í‚·: {bucket}",
        f"ì¦ìƒ: {', '.join(symptoms[:5])}"
    ]

    if demographics.age >= 65:
        parts.append("ê³ ë ¹ì ì•ˆì „ ìš´ë™")
    elif demographics.age >= 50:
        parts.append("ì¤‘ë…„ ì í•© ìš´ë™")

    return " ".join(parts)
```

#### ê²€ìƒ‰ í•„í„°

```python
filters = {
    "body_part": body_part,    # ë¶€ìœ„ í•„í„°
    "source": "exercise"       # ìš´ë™ ë°ì´í„°ë§Œ
}

# min_score: 0.35 (ìœ ì‚¬ë„ ì„ê³„ê°’)
# top_k: 20 (í›„ë³´ ìš´ë™ ìˆ˜)
```

### 6.5 LLM í”„ë¡¬í”„íŠ¸ êµ¬ì„±

#### í™˜ì í”„ë¡œí•„ ë¶„ì„

```markdown
## í™˜ì íŠ¹ì„± ë¶„ì„ (ê°œì¸í™” í•„ìˆ˜ ë°˜ì˜)
- **ê³ ë ¹ í™˜ì**: ë‚™ìƒ ìœ„í—˜ ê³ ë ¤, ê· í˜•/ì•ˆì •ì„± ìš´ë™ í•„ìˆ˜, ê³ ê°•ë„ ìš´ë™ ì œì™¸
- **ë¹„ë§Œ**: ê´€ì ˆ ë¶€ë‹´ ê³ ë ¤, ì €ì¶©ê²© ìš´ë™ ì„ íƒ
- **ì‹¬í•œ í†µì¦**: ì €ê°•ë„ ê°€ë™ì„± ìš´ë™ë§Œ, ê·¼ë ¥ ìš´ë™ ìµœì†Œí™”
- **ì‹ ì²´ Lv D**: ê¸°ì´ˆ ìš´ë™ë§Œ, ì €ê°•ë„ ìœ„ì£¼
```

#### ì„ íƒ ê¸°ì¤€

```markdown
## ì„ íƒ ê¸°ì¤€ (ì¤‘ìš”ë„ ìˆœ)
1. **í™˜ì íŠ¹ì„± ë§ì¶¤**: ë‚˜ì´/BMI/í†µì¦ì— ë”°ë¥¸ ìš´ë™ ê°•ë„ ì¡°ì ˆ
2. **ê¸°ëŠ¥ ê· í˜•**: ê°€ë™ì„±, ê·¼ë ¥, ì•ˆì •ì„± ìš´ë™ì„ ê· í˜• ìˆê²Œ í¬í•¨
3. **ë‹¤ì–‘ì„±**: ê°™ì€ ê¸°ëŠ¥ì˜ ìš´ë™ë§Œ ì„ íƒí•˜ì§€ ë§ê³  ë‹¤ì–‘í•˜ê²Œ ì„ íƒ
4. **ì§„í–‰ì„±**: ì‰¬ìš´ ìš´ë™ â†’ ì–´ë ¤ìš´ ìš´ë™ ìˆœì„œë¡œ ë°°ì¹˜

## ê°œì¸í™” ê°€ì´ë“œ
- ê³ ë ¹ì(65+): ê· í˜•/ì•ˆì •ì„± ìš´ë™ ìš°ì„ , ê³ ê°•ë„ ì œì™¸
- ë¹„ë§Œ(BMI 30+): ì²´ì¤‘ ë¶€í•˜ ì ì€ ìš´ë™ ìš°ì„ 
- ê³ í†µì¦(NRS 7+): ì €ê°•ë„, ê°€ë™ì„± ìœ„ì£¼
- ì Šì€ ì¸µ(40-): ê·¼ë ¥ ìš´ë™ ë¹„ì¤‘ ë†’ê²Œ
```

#### ì‘ë‹µ í˜•ì‹

```json
{
    "selected_exercises": ["E01", "E06", "E09", ...],
    "reasons": {
        "E01": "ROM ì œí•œ í™˜ìì—ê²Œ ì í•©í•œ ì €ê°•ë„ ê°€ë™ì„± ìš´ë™"
    },
    "scores": {
        "E01": 0.95
    },
    "combination_rationale": {
        "why_together": "ê°€ë™ì„± â†’ ì•ˆì •ì„± â†’ ê·¼ë ¥ ìˆœì„œë¡œ ì ì§„ì  ê°•í™”",
        "bucket_coverage": "OA ê´€ì ˆ ë³´í˜¸ë¥¼ ìœ„í•œ ì €ì¶©ê²© ìš´ë™ ì¡°í•©",
        "progression_logic": "ì¤€ë¹„ â†’ ë³¸ìš´ë™ â†’ ë§ˆë¬´ë¦¬ ìˆœì„œ"
    },
    "patient_fit": {
        "age_consideration": "55ì„¸ ì¤‘ë…„ì¸µ, ì¤‘ë“±ë„ ìš´ë™ ê°€ëŠ¥",
        "bmi_consideration": "BMI 26.5 ê³¼ì²´ì¤‘, ì²´ì¤‘ ë¶€í•˜ ìµœì†Œí™”",
        "nrs_consideration": "NRS 5 ì¤‘ë“±ë„ í†µì¦, ê³ ê°•ë„ ì œì™¸"
    },
    "reasoning": "ì „ì²´ ì¶”ì²œ ìš”ì•½"
}
```

---

## 7. API ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸

### 7.1 ë²„í‚· ì¶”ë¡  API (Port 8001)

```bash
POST /api/v1/infer-bucket
```

#### Request ìŠ¤í‚¤ë§ˆ

```json
{
  "demographics": {
    "age": 55,
    "sex": "female",
    "height_cm": 160,
    "weight_kg": 65
  },
  "body_parts": [{
    "code": "knee",
    "primary": true,
    "side": "both",
    "symptoms": ["pain_bilateral", "chronic", "stairs_down", "stiffness_morning"],
    "nrs": 6,
    "red_flags_checked": []
  }],
  "natural_language": {
    "chief_complaint": "ì–‘ìª½ ë¬´ë¦ì´ ì•„í”„ê³  ê³„ë‹¨ ë‚´ë ¤ê°ˆ ë•Œ í˜ë“¤ì–´ìš”",
    "pain_description": "ì•„ì¹¨ì— ë»£ë»£í•˜ê³  30ë¶„ ì •ë„ ì§€ë‚˜ë©´ ë‚˜ì•„ì ¸ìš”",
    "history": "5ë…„ ì „ë¶€í„° ì„œì„œíˆ ì‹¬í•´ì§"
  }
}
```

#### Request í•„ë“œ ìƒì„¸

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|------|------|
| **demographics** | object | âœ“ | ì¸êµ¬í†µê³„í•™ì  ì •ë³´ |
| â”œâ”€ age | int | âœ“ | ë‚˜ì´ (10-100) |
| â”œâ”€ sex | string | âœ“ | ì„±ë³„ (`male` / `female`) |
| â”œâ”€ height_cm | float | âœ“ | í‚¤ (cm, 100-250) |
| â””â”€ weight_kg | float | âœ“ | ëª¸ë¬´ê²Œ (kg, 30-200) |
| **body_parts** | array | âœ“ | ë¶€ìœ„ë³„ ì¦ìƒ ì…ë ¥ (ìµœì†Œ 1ê°œ) |
| â”œâ”€ code | string | âœ“ | ë¶€ìœ„ ì½”ë“œ (`knee`, `shoulder`, `back`, `neck`, `ankle`) |
| â”œâ”€ primary | bool | | ì£¼ìš” ë¶€ìœ„ ì—¬ë¶€ (ê¸°ë³¸: true) |
| â”œâ”€ side | string | | ì¢Œìš° êµ¬ë¶„ (`left` / `right` / `both`) |
| â”œâ”€ symptoms | array | | ì¦ìƒ ì½”ë“œ ë¦¬ìŠ¤íŠ¸ |
| â”œâ”€ nrs | int | âœ“ | í†µì¦ ì ìˆ˜ (0-10) |
| â””â”€ red_flags_checked | array | | í™•ì¸ëœ ë ˆë“œí”Œë˜ê·¸ ì½”ë“œ |
| **natural_language** | object | | ìì—°ì–´ ì…ë ¥ (ì„ íƒ) |
| â”œâ”€ chief_complaint | string | | ì£¼í˜¸ì†Œ - ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥í•œ ì¦ìƒ ì„¤ëª… |
| â”œâ”€ pain_description | string | | í†µì¦ ì„¤ëª… - ì–¸ì œ, ì–´ë–»ê²Œ, ì–´ë””ê°€ ì•„í”ˆì§€ |
| â””â”€ history | string | | ë³‘ë ¥ - ì´ì „ ì¹˜ë£Œ, ë¶€ìƒ ê²½í—˜ ë“± |

#### ì¦ìƒ ì½”ë“œ ì˜ˆì‹œ (ë¬´ë¦)

| ì½”ë“œ | ì„¤ëª… | ê´€ë ¨ ë²„í‚· |
|------|------|----------|
| `pain_stairs` | ê³„ë‹¨ ì˜¤ë¥´ë‚´ë¦´ ë•Œ í†µì¦ | OA |
| `stiffness_morning` | ì•„ì¹¨ ë»£ë»£í•¨ | OA |
| `pain_running` | ë‹¬ë¦¬ê¸° ì‹œ í†µì¦ | OVR |
| `swelling_acute` | ê¸‰ì„± ë¶€ì¢… | TRM, INF |
| `instability` | ë¬´ë¦ ë¶ˆì•ˆì •ê° | TRM |
| `warmth_redness` | ì—´ê°/ë°œì  | INF |

#### Response ìŠ¤í‚¤ë§ˆ

```json
{
  "body_part": "knee",
  "final_bucket": "OA",
  "confidence": 0.85,
  "bucket_scores": {
    "OA": 15.0,
    "OVR": 4.0,
    "TRM": 0.0,
    "INF": 2.0
  },
  "weight_ranking": ["OA", "OVR", "INF", "TRM"],
  "search_ranking": ["OA", "OVR", "TRM"],
  "discrepancy": null,
  "evidence_summary": "ê²€ì¦ëœ ë…¼ë¬¸ê³¼ OARSI ê°€ì´ë“œë¼ì¸ì— ë”°ë¥´ë©´, 55ì„¸ ì—¬ì„±ì˜ ì–‘ì¸¡ ë¬´ë¦ í†µì¦, ì•„ì¹¨ ë»£ë»£í•¨, ê³„ë‹¨ í†µì¦ì€ í‡´í–‰ì„± ê´€ì ˆì—¼(OA)ì˜ ì „í˜•ì ì¸ ì¦ìƒì…ë‹ˆë‹¤.",
  "llm_reasoning": "### ë²„í‚· íŒë‹¨ ê·¼ê±°\n- **ê°€ì¤‘ì¹˜ ë¶„ì„**: OA 15ì ìœ¼ë¡œ ìµœê³ ì \n- **ê²€ìƒ‰ ë¶„ì„**: OA ê´€ë ¨ ë…¼ë¬¸ 5ê°œ ë§¤ì¹­\n- **ê²°ë¡ **: ë‘ ê²½ë¡œ ì¼ì¹˜, OAë¡œ ìµœì¢… íŒë‹¨",
  "red_flag": null,
  "inferred_at": "2025-12-05T12:00:00"
}
```

#### Response í•„ë“œ ìƒì„¸

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| **body_part** | string | ë¶€ìœ„ ì½”ë“œ |
| **final_bucket** | string | ìµœì¢… ì§„ë‹¨ ë²„í‚· (`OA` / `OVR` / `TRM` / `INF`) |
| **confidence** | float | ì‹ ë¢°ë„ (0-1) |
| **bucket_scores** | object | ë²„í‚·ë³„ ê°€ì¤‘ì¹˜ ì ìˆ˜ |
| â”œâ”€ OA | float | í‡´í–‰ì„± ê´€ì ˆì—¼ ì ìˆ˜ |
| â”œâ”€ OVR | float | ê³¼ì‚¬ìš© ì ìˆ˜ |
| â”œâ”€ TRM | float | ì™¸ìƒ ì ìˆ˜ |
| â””â”€ INF | float | ì—¼ì¦ ì ìˆ˜ |
| **weight_ranking** | array | ê°€ì¤‘ì¹˜ ê¸°ë°˜ ë²„í‚· ìˆœìœ„ |
| **search_ranking** | array | ë²¡í„° ê²€ìƒ‰ ê¸°ë°˜ ë²„í‚· ìˆœìœ„ |
| **discrepancy** | object \| null | ê°€ì¤‘ì¹˜ vs ê²€ìƒ‰ ë¶ˆì¼ì¹˜ ì •ë³´ |
| â”œâ”€ type | string | ë¶ˆì¼ì¹˜ ìœ í˜• |
| â”œâ”€ weight_ranking | array | ê°€ì¤‘ì¹˜ ìˆœìœ„ |
| â”œâ”€ search_ranking | array | ê²€ìƒ‰ ìˆœìœ„ |
| â”œâ”€ message | string | ê²½ê³  ë©”ì‹œì§€ |
| â””â”€ severity | string | ì‹¬ê°ë„ (`warning` / `critical`) |
| **evidence_summary** | string | ê·¼ê±° ìš”ì•½ (LLM ìƒì„±, ë…¼ë¬¸ ì¸ìš© í¬í•¨) |
| **llm_reasoning** | string | LLM íŒë‹¨ ê·¼ê±° (ë§ˆí¬ë‹¤ìš´) |
| **red_flag** | object \| null | ë ˆë“œí”Œë˜ê·¸ ê²°ê³¼ |
| â”œâ”€ triggered | bool | ë ˆë“œí”Œë˜ê·¸ ë°œë™ ì—¬ë¶€ |
| â”œâ”€ flags | array | ë°œë™ëœ ë ˆë“œí”Œë˜ê·¸ ì½”ë“œ |
| â”œâ”€ messages | array | ê²½ê³  ë©”ì‹œì§€ë“¤ |
| â””â”€ action | string | ê¶Œì¥ ì¡°ì¹˜ (ì˜ˆ: "ì¦‰ì‹œ ë³‘ì› ë°©ë¬¸") |
| **inferred_at** | datetime | ì¶”ë¡  ì‹œê°„ (ISO 8601) |

---

### 7.2 ìš´ë™ ì¶”ì²œ API (Port 8002)

```bash
POST /api/v1/recommend-exercises
```

#### Request ìŠ¤í‚¤ë§ˆ

```json
{
  "user_id": "user_001",
  "body_part": "knee",
  "bucket": "OA",
  "physical_score": {
    "total_score": 9
  },
  "demographics": {
    "age": 55,
    "sex": "female",
    "height_cm": 160,
    "weight_kg": 65
  },
  "nrs": 5,
  "previous_assessments": [
    {
      "session_date": "2025-12-04T10:00:00",
      "difficulty_felt": 3,
      "muscle_stimulus": 3,
      "sweat_level": 2,
      "pain_during_exercise": 4,
      "skipped_exercises": [],
      "completed_sets": 10,
      "total_sets": 12
    }
  ],
  "last_assessment_date": "2025-12-04T10:00:00",
  "skipped_exercises": ["E05"],
  "favorite_exercises": ["E01", "E02"]
}
```

#### Request í•„ë“œ ìƒì„¸

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|------|------|
| **user_id** | string | âœ“ | ì‚¬ìš©ì ID |
| **body_part** | string | âœ“ | ë¶€ìœ„ ì½”ë“œ (`knee` ë“±) |
| **bucket** | string | âœ“ | ë²„í‚· ì¶”ë¡  ê²°ê³¼ (`OA`/`OVR`/`TRM`/`INF`) |
| **physical_score** | object | âœ“ | ì‹ ì²´ ì ìˆ˜ |
| â””â”€ total_score | int | âœ“ | ì‚¬ì „í‰ê°€ ì´ì  (4-16) |
| **demographics** | object | âœ“ | ì¸êµ¬í†µê³„ ì •ë³´ (ìœ„ì™€ ë™ì¼) |
| **nrs** | int | âœ“ | í˜„ì¬ í†µì¦ ì ìˆ˜ (0-10) |
| **previous_assessments** | array | | ì´ì „ ì‚¬í›„ ì„¤ë¬¸ (ìµœëŒ€ 3ì„¸ì…˜) |
| â”œâ”€ session_date | datetime | âœ“ | ì„¸ì…˜ ë‚ ì§œ |
| â”œâ”€ difficulty_felt | int | âœ“ | ìš´ë™ ë‚œì´ë„ ì²´ê° (1-5) |
| â”œâ”€ muscle_stimulus | int | âœ“ | ê·¼ìœ¡ ìê·¹ ì •ë„ (1-5) |
| â”œâ”€ sweat_level | int | âœ“ | ë•€ ë°°ì¶œëŸ‰ (1-5) |
| â”œâ”€ pain_during_exercise | int | | ìš´ë™ ì¤‘ í†µì¦ (0-10) |
| â”œâ”€ skipped_exercises | array | | ê±´ë„ˆë›´ ìš´ë™ ID ëª©ë¡ |
| â”œâ”€ completed_sets | int | | ì™„ë£Œí•œ ì„¸íŠ¸ ìˆ˜ |
| â””â”€ total_sets | int | | ì´ ì„¸íŠ¸ ìˆ˜ |
| **last_assessment_date** | datetime | | ë§ˆì§€ë§‰ ì‚¬í›„ ì„¤ë¬¸ ë‚ ì§œ |
| **skipped_exercises** | array | | ìì£¼ ê±´ë„ˆë›´ ìš´ë™ ID (ìš°ì„ ìˆœìœ„ â†“) |
| **favorite_exercises** | array | | ì¦ê²¨ì°¾ê¸° ìš´ë™ ID (ìš°ì„ ìˆœìœ„ â†‘) |

#### ì‹ ì²´ ì ìˆ˜ ë ˆë²¨

| ë ˆë²¨ | ì ìˆ˜ ë²”ìœ„ | í—ˆìš© ë‚œì´ë„ | ìš´ë™ ê°œìˆ˜ |
|------|----------|------------|----------|
| **A** | 14-16ì  | low, medium, high | 6ê°œ |
| **B** | 11-13ì  | low, medium, high | 5ê°œ |
| **C** | 8-10ì  | low, medium | 4ê°œ |
| **D** | 4-7ì  | low | 3ê°œ |

#### Response ìŠ¤í‚¤ë§ˆ

```json
{
  "user_id": "user_001",
  "body_part": "knee",
  "bucket": "OA",
  "exercises": [
    {
      "exercise_id": "E01",
      "name_kr": "í ìŠ¬ë¼ì´ë“œ",
      "name_en": "Heel Slide",
      "difficulty": "low",
      "function_tags": ["Mobility", "Stretching"],
      "target_muscles": ["ëŒ€í‡´ì‚¬ë‘ê·¼", "í–„ìŠ¤íŠ¸ë§"],
      "sets": 2,
      "reps": "10íšŒ",
      "rest": "30ì´ˆ",
      "reason": "ë¬´ë¦ ê°€ë™ë²”ìœ„ ê°œì„ ì— íš¨ê³¼ì ì´ë©°, 55ì„¸ ì—¬ì„±ì˜ OA ìƒíƒœì— ì í•©í•œ ì €ê°•ë„ ìš´ë™ì…ë‹ˆë‹¤.",
      "priority": 1,
      "match_score": 0.95,
      "youtube": "https://youtube.com/watch?v=xxx",
      "description": "ëˆ„ìš´ ìƒíƒœì—ì„œ ë°œê¿ˆì¹˜ë¥¼ ë°”ë‹¥ì— ëŒ€ê³  ë¬´ë¦ì„ êµ¬ë¶€ë ¸ë‹¤ í…ë‹ˆë‹¤."
    },
    {
      "exercise_id": "E02",
      "name_kr": "í´ë¨ì‰˜",
      "name_en": "Clamshell",
      "difficulty": "low",
      "function_tags": ["Strengthening", "Stability"],
      "target_muscles": ["ì¤‘ë‘”ê·¼", "ì™¸íšŒì „ê·¼"],
      "sets": 2,
      "reps": "15íšŒ",
      "rest": "30ì´ˆ",
      "reason": "ê³ ê´€ì ˆ ì•ˆì •ì„± ê°•í™”ë¡œ ë¬´ë¦ ë¶€ë‹´ì„ ì¤„ì—¬ì¤ë‹ˆë‹¤.",
      "priority": 2,
      "match_score": 0.92,
      "youtube": "https://youtube.com/watch?v=yyy",
      "description": "ì˜†ìœ¼ë¡œ ëˆ„ì›Œ ë¬´ë¦ì„ êµ¬ë¶€ë¦° ìƒíƒœì—ì„œ ìœ„ìª½ ë¬´ë¦ì„ ë“¤ì–´ì˜¬ë¦½ë‹ˆë‹¤."
    }
  ],
  "excluded": [
    {
      "exercise_id": "E10",
      "name_kr": "ì í”„ ìŠ¤ì¿¼íŠ¸",
      "reason": "NRS 5ì ìœ¼ë¡œ ê³ ê°•ë„ ìš´ë™ ì œì™¸",
      "exclusion_type": "nrs"
    }
  ],
  "routine_order": ["E01", "E02", "E03", "E04", "E05"],
  "total_duration_min": 15,
  "difficulty_level": "low",
  "adjustments_applied": {
    "difficulty_delta": 0,
    "sets_delta": 0,
    "reps_delta": 0
  },
  "assessment_status": "normal",
  "assessment_message": "2ì„¸ì…˜ ì™„ë£Œ. 1ì„¸ì…˜ í›„ ë‚œì´ë„ê°€ ì¡°ì •ë©ë‹ˆë‹¤.",
  "llm_reasoning": "### ìš´ë™ ì¡°í•© ê·¼ê±°\n- **ì‹œë„ˆì§€**: ê°€ë™ì„± â†’ ê·¼ë ¥ ìˆœì„œë¡œ ì›Œë°ì—… íš¨ê³¼ ê·¹ëŒ€í™”\n- **ë²„í‚· ì¹˜ë£Œ**: OA ê´€ì ˆ ë³´í˜¸ë¥¼ ìœ„í•œ ì €ì¶©ê²© ìš´ë™ ìœ„ì£¼ ì„ íƒ\n\n### í™˜ì ë§ì¶¤ ê³ ë ¤ì‚¬í•­\n- **ë‚˜ì´ ê³ ë ¤**: 55ì„¸ë¡œ ì¤‘ë…„ê¸°, ì¤‘ë“±ë„ ì´í•˜ ë‚œì´ë„ ì í•©\n- **BMI ê³ ë ¤**: 25.4ë¡œ ê³¼ì²´ì¤‘, ì²´ì¤‘ ë¶€í•˜ ìš´ë™ ìµœì†Œí™”\n- **í†µì¦ ê³ ë ¤**: NRS 5ì ìœ¼ë¡œ ì¤‘ë“±ë„ í†µì¦, ê³ ê°•ë„ ì œì™¸",
  "recommended_at": "2025-12-05T12:30:00"
}
```

#### Response í•„ë“œ ìƒì„¸

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| **user_id** | string | ì‚¬ìš©ì ID |
| **body_part** | string | ë¶€ìœ„ ì½”ë“œ |
| **bucket** | string | ì§„ë‹¨ ë²„í‚· |
| **exercises** | array | ì¶”ì²œ ìš´ë™ ëª©ë¡ (ìµœì†Œ 1ê°œ) |
| â”œâ”€ exercise_id | string | ìš´ë™ ID |
| â”œâ”€ name_kr | string | í•œê¸€ëª… |
| â”œâ”€ name_en | string | ì˜ë¬¸ëª… |
| â”œâ”€ difficulty | string | ë‚œì´ë„ (`low`/`medium`/`high`) |
| â”œâ”€ function_tags | array | ê¸°ëŠ¥ íƒœê·¸ (ì•„ë˜ ì°¸ì¡°) |
| â”œâ”€ target_muscles | array | íƒ€ê²Ÿ ê·¼ìœ¡ |
| â”œâ”€ sets | int | ì„¸íŠ¸ ìˆ˜ |
| â”œâ”€ reps | string | ë°˜ë³µ íšŸìˆ˜ (ì˜ˆ: "10íšŒ", "30ì´ˆ") |
| â”œâ”€ rest | string | íœ´ì‹ ì‹œê°„ (ì˜ˆ: "30ì´ˆ") |
| â”œâ”€ reason | string | ì´ í™˜ìì—ê²Œ ì¶”ì²œí•˜ëŠ” êµ¬ì²´ì  ì´ìœ  |
| â”œâ”€ priority | int | ìš°ì„ ìˆœìœ„ (1=ìµœìš°ì„ ) |
| â”œâ”€ match_score | float | ì í•©ë„ ì ìˆ˜ (0-1) |
| â”œâ”€ youtube | string \| null | ìœ íŠœë¸Œ ì˜ìƒ ë§í¬ |
| â””â”€ description | string \| null | ìš´ë™ ì„¤ëª… |
| **excluded** | array | ì œì™¸ëœ ìš´ë™ ëª©ë¡ |
| â”œâ”€ exercise_id | string | ìš´ë™ ID |
| â”œâ”€ name_kr | string | í•œê¸€ëª… |
| â”œâ”€ reason | string | ì œì™¸ ì‚¬ìœ  |
| â””â”€ exclusion_type | string | ì œì™¸ ìœ í˜• (ì•„ë˜ ì°¸ì¡°) |
| **routine_order** | array | ë£¨í‹´ ìˆœì„œ (ìš´ë™ ID ë°°ì—´) |
| **total_duration_min** | int | ì˜ˆìƒ ì†Œìš” ì‹œê°„ (ë¶„) |
| **difficulty_level** | string | ì „ì²´ ë‚œì´ë„ (`low`/`medium`/`high`/`mixed`) |
| **adjustments_applied** | object | ì ìš©ëœ ì¡°ì • |
| â”œâ”€ difficulty_delta | int | ë‚œì´ë„ ë³€í™” (-1/0/+1) |
| â”œâ”€ sets_delta | int | ì„¸íŠ¸ ìˆ˜ ë³€í™” |
| â””â”€ reps_delta | int | ë°˜ë³µ íšŸìˆ˜ ë³€í™” |
| **assessment_status** | string | ì‚¬í›„ ì„¤ë¬¸ ì²˜ë¦¬ ìƒíƒœ (ì•„ë˜ ì°¸ì¡°) |
| **assessment_message** | string | ì‚¬í›„ ì„¤ë¬¸ ì²˜ë¦¬ ë©”ì‹œì§€ |
| **llm_reasoning** | string | LLM ì¶”ì²œ ê·¼ê±° (ë§ˆí¬ë‹¤ìš´) |
| **recommended_at** | datetime | ì¶”ì²œ ì‹œê°„ (ISO 8601) |

#### function_tags (ê¸°ëŠ¥ íƒœê·¸)

| íƒœê·¸ | ì„¤ëª… | ë£¨í‹´ ìˆœì„œ |
|------|------|----------|
| `Mobility` | ê´€ì ˆ ê°€ë™ì„± | 1 (ì¤€ë¹„) |
| `Stretching` | ìŠ¤íŠ¸ë ˆì¹­ | 2 (ì¤€ë¹„) |
| `Strengthening` | ê·¼ë ¥ ê°•í™” | 3 (ë³¸ìš´ë™) |
| `Stability` | ì•ˆì •ì„± | 4 (ë§ˆë¬´ë¦¬) |
| `Balance` | ê· í˜• | 5 (ë§ˆë¬´ë¦¬) |

#### exclusion_type (ì œì™¸ ìœ í˜•)

| íƒ€ì… | ì„¤ëª… |
|------|------|
| `contraindication` | ê¸ˆê¸° ì‚¬í•­ |
| `difficulty` | ë‚œì´ë„ ë¶€ì í•© |
| `nrs` | í†µì¦ ì ìˆ˜ ê¸°ì¤€ ì œì™¸ |
| `assessment` | ì‚¬í›„ ì„¤ë¬¸ ê¸°ë°˜ ì œì™¸ |

#### assessment_status (ì‚¬í›„ ì„¤ë¬¸ ìƒíƒœ)

| ìƒíƒœ | ì„¤ëª… |
|------|------|
| `fresh_start` | ìµœì´ˆ ìš´ë™ (ì‚¬ì „ í‰ê°€ë§Œ ì‚¬ìš©) |
| `normal` | ì •ìƒ (ì´ì „ ê¸°ë¡ ë°˜ì˜, 3ì„¸ì…˜ ì™„ë£Œ ì‹œ ì¡°ì •) |
| `reset` | ë¦¬ì…‹ (7ì¼+ ë¯¸ì ‘ì† ë˜ëŠ” ê¸°ë¡ ì†ì‹¤) |

---

### 7.3 Gateway í†µí•© API (ì•±ìš©, Port 8000)

```bash
POST /api/v1/diagnose
POST /api/v1/recommend-exercises
```

#### Request (UnifiedRequest)

í•„ìˆ˜:
- `user_id`
- `demographics` (age/sex/height_cm/weight_kg)
- `body_parts[]` (code/side/symptoms/nrs)

ì„ íƒ:
- `request_id`
- `physical_score.total_score` (4-16)
- `natural_language` (chief_complaint/pain_description/history)
- `raw_survey_responses`
- `options` (include_exercises/exercise_days/skip_exercise_on_red_flag)

ìµœì†Œ ìš”ì²­ (ë²„í‚· ì¶”ë¡ ë§Œ):
```json
{
  "user_id": "user_001",
  "demographics": {
    "age": 55,
    "sex": "female",
    "height_cm": 160,
    "weight_kg": 65
  },
  "body_parts": [
    {
      "code": "knee",
      "primary": true,
      "side": "both",
      "symptoms": ["pain_medial", "stiffness_morning"],
      "nrs": 6,
      "red_flags_checked": []
    }
  ],
  "options": {
    "include_exercises": false
  }
}
```

ì „ì²´ ìš”ì²­ (ë²„í‚· ì¶”ë¡  + ìš´ë™ ì¶”ì²œ):
```json
{
  "user_id": "user_123",
  "demographics": {
    "age": 55,
    "sex": "male",
    "height_cm": 175,
    "weight_kg": 80
  },
  "body_parts": [
    {
      "code": "knee",
      "primary": true,
      "side": "left",
      "symptoms": ["pain_medial", "stiffness_morning"],
      "nrs": 6,
      "red_flags_checked": []
    }
  ],
  "physical_score": {
    "total_score": 12
  },
  "options": {
    "include_exercises": true,
    "exercise_days": 3,
    "skip_exercise_on_red_flag": true
  }
}
```

#### Response (UnifiedResponse)

ì£¼ìš” í•„ë“œ:
- `survey_data` (ìš”ì²­ ì›ë³¸ ì €ì¥ìš©)
- `diagnosis` (final_bucket, confidence, evidence_summary, red_flag ë“±)
- `exercise_plan` (ì—†ìœ¼ë©´ null)
- `status`, `message`, `processing_time_ms`

ìµœì†Œ ì‘ë‹µ ì˜ˆì‹œ:
```json
{
  "request_id": "uuid",
  "user_id": "user_001",
  "diagnosis": {
    "body_part": "knee",
    "final_bucket": "OA",
    "confidence": 0.75
  },
  "exercise_plan": null,
  "status": "success",
  "processing_time_ms": 8000
}
```

---

### 7.4 Dudduk ì•± ì—°ë™ ë§¤í•‘

#### Dudduk -> OrthoCare

| Dudduk API | í•„ë“œ | OrthoCare í•„ë“œ | ë³€í™˜ |
|---|---|---|---|
| User | userId | user_id | ê·¸ëŒ€ë¡œ |
| User | birthDate | demographics.age | ìƒë…„ì›”ì¼ -> ë‚˜ì´ |
| User | gender | demographics.sex | male/female |
| User | height | demographics.height_cm | ê·¸ëŒ€ë¡œ |
| User | weight | demographics.weight_kg | ê·¸ëŒ€ë¡œ |
| PainSurvey | painArea | body_parts[0].code | knee/shoulder/back/neck/ankle |
| PainSurvey | affectedSide | body_parts[0].side | left/right/both |
| PainSurvey | painLevel | body_parts[0].nrs | 0-10 |
| PainSurvey | painTrigger | body_parts[0].symptoms | survey_mapping ë³€í™˜ |
| PainSurvey | painSensation | body_parts[0].symptoms | survey_mapping ë³€í™˜ |
| PainSurvey | painDuration | body_parts[0].symptoms | survey_mapping ë³€í™˜ |
| PainSurvey | redFlags | body_parts[0].red_flags_checked | red_flags ì½”ë“œ |
| ExerciseAbilitySurvey | squat/pushup/stepup/plank | physical_score.total_score | 4ë¬¸í•­ í•©ì‚°(4-16) |

ê¶Œì¥: `raw_survey_responses`ì— Dudduk ì„¤ë¬¸ ì›ë³¸ì„ ì €ì¥í•˜ê³ ,
ì„œë²„ì—ì„œ `data/medical/{body_part}/survey_mapping.json` ê¸°ì¤€ìœ¼ë¡œ `symptoms` ìƒì„±.

#### ë¬´ë¦ ì„¤ë¬¸ í‚¤ (Knee)

ê¸°ì¤€: `data/medical/knee/survey_mapping.json`

- Q1_location: left/right/both, medial, lateral, anterior
- Q2_onset: gradual, progressive_1month, after_activity_increase, after_trauma, after_exercise
- Q4_aggravating: walking_standing, stairs_up, stairs_down, squatting, cross_legged, after_exercise, twisting, morning, at_rest
- Q5_quality: locking_catching, heavy_dull, swelling_heat, point_tenderness, morning_stiffness(under_30min/over_30min)

ë ˆë“œí”Œë˜ê·¸: `data/medical/knee/red_flags.json`ì˜ `survey_mapping` ì½”ë“œ ì‚¬ìš©.

#### ì–´ê¹¨ ì„¤ë¬¸ í‚¤ (Shoulder)

ê¸°ì¤€: `data/medical/shoulder/survey_mapping.json`

- Q1_location: left/right/both, anterior, lateral, superior, axillary, cervical_trapezius
- Q2_onset: gradual, activity_increase, trauma, progressive_stiff
- Q4_aggravating: abduction_overhead, forward_flexion, internal_rotation_behind, heavy_lifting, lying_on_side, arm_sustained, at_rest
- Q5_quality: catching, sharp, dull_heavy, stiff, night_rest

ë ˆë“œí”Œë˜ê·¸ ì½”ë“œ:
- severe_pain_no_movement
- acute_swelling_heat
- weakness_numbness
- radiating_pain_cervical
- fever_chills
- post_injection_pain

#### OrthoCare -> Dudduk

- `diagnosis.final_bucket` -> `PainSurveyResponse.diagnosis`
- `diagnosis.evidence_summary` -> `PainSurveyResponse.recommendation`
- `diagnosis.red_flag.triggered=true`ë©´ ìš´ë™ ë£¨í‹´ ìƒì„± ìŠ¤í‚µ
- `exercise_plan.exercises[]` -> `POST /api/routines`ì˜ `RoutineExerciseItem`

---

### 7.5 AI ì—°ë™ API ë¬¸ì„œ (ë°±ì—”ë“œ <-> AI)

AI ì¸¡ ì—”ë“œí¬ì¸íŠ¸ëŠ” ë³„ë„ë¡œ ì •ì˜í•©ë‹ˆë‹¤.

#### 7.5.1 ìœ ì € ì •ë³´ ì¡°íšŒ

Request (ë°±ì—”ë“œ -> AI)
```json
{
  "birthDate": "2026-01-06",
  "gender": "MALE",
  "height": 170,
  "weight": 65
}
```

í•„ë“œ ì„¤ëª…:
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|---|---|---|---|
| birthDate | string | âœ“ | ìƒë…„ì›”ì¼ (YYYY-MM-DD) |
| gender | string | âœ“ | ì„±ë³„ (MALE/FEMALE) |
| height | integer | âœ“ | í‚¤ (cm) |
| weight | number | âœ“ | ëª¸ë¬´ê²Œ (kg) |

#### 7.5.2 ë²„í‚· ì¶”ë¡  (í†µì¦ ì„¤ë¬¸ ê¸°ë°˜)

Request (ë°±ì—”ë“œ -> AI)
```json
{
  "userId": 1,
  "painArea": "ë¬´ë¦",
  "affectedSide": "ì–‘ìª½",
  "painStartedDate": "ë¬´ë¦¬í•˜ê²Œ ìš´ë™í•œ ì´í›„ë¶€í„° ì•„íŒŒìš”",  // ì–¸ì œ/ì–´ë–¤ ê³„ê¸°ë¡œ ì‹œì‘í–ˆëŠ”ì§€ ììœ ê¸°ìˆ 
  "painLevel": 6,
  "painTrigger": "ì˜¤ë˜ ê±·ê±°ë‚˜ ì„œìˆì„ ë•Œ",            // ì˜ˆ: ê³„ë‹¨ ë‚´ë ¤ê°ˆ ë•Œ, ë¹„í‹€ ë•Œ, ê°€ë§Œíˆ ìˆì–´ë„
  "painSensation": "ë»ê·¼/ë¬µì§",                     // ì˜ˆ: ì°Œë¦¿/ì½•ì½•, ê±¸ë¦¬ëŠ” ëŠë‚Œ, íƒ€ëŠ” ë“¯
  "painDuration": "ì•„ì¹¨ì— 30ë¶„ ì •ë„",                // ì˜ˆ: ë°¤ì— ê¹¨ì„œ ì•„íŒŒìš”, í•˜ë£¨ ì¢…ì¼, ìš´ë™ í›„ ëª‡ ì‹œê°„
  "birthDate": "2000-01-01",
  "gender": "MALE",
  "height": 170,
  "weight": 65
}
```

í•„ë“œ ì„¤ëª…:
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|---|---|---|---|
| userId | integer | âœ“ | ì‚¬ìš©ì ID |
| painArea | string | âœ“ | ì•„í”ˆ ë¶€ìœ„ |
| affectedSide | string | âœ“ | ì–´ëŠ ìª½ì´ ì•„í”ˆì§€ |
| painStartedDate | string | âœ“ | ì–¸ì œë¶€í„°/ì–´ë–¤ ê³„ê¸°ë¡œ ì•„íŒ ëŠ”ì§€ (ììœ  ì„œìˆ , ì˜ˆ: â€œë¬´ë¦¬í•˜ê²Œ ìš´ë™í•œ ì´í›„ë¶€í„° ì•„íŒŒìš”â€) |
| painLevel | integer | âœ“ | í†µì¦ ì •ë„ (0-10) |
| painTrigger | string | âœ“ | ì–¸ì œ í†µì¦ì´ ë” ì‹¬í•´ì§€ëŠ”ì§€ (ì˜ˆ: â€œì˜¤ë˜ ê±·ê±°ë‚˜ ì„œìˆì„ ë•Œâ€, â€œê³„ë‹¨ ë‚´ë ¤ê°ˆ ë•Œâ€) |
| painSensation | string | âœ“ | ì–´ë–¤ ëŠë‚Œìœ¼ë¡œ ì•„í”ˆì§€ (ì˜ˆ: â€œë»ê·¼/ë¬µì§â€, â€œì°Œë¦¿/ì½•ì½•â€, â€œê±¸ë¦¬ëŠ” ëŠë‚Œâ€) |
| painDuration | string | âœ“ | í†µì¦ì´ ì–¼ë§ˆë‚˜ ì§€ì†ë˜ëŠ”ì§€ (ì˜ˆ: â€œì•„ì¹¨ì— 30ë¶„ ì •ë„â€, â€œë°¤ì— ê¹¨ì„œ ì•„íŒŒìš”â€) |
| birthDate | string | âœ“ | ìƒë…„ì›”ì¼ (YYYY-MM-DD) |
| gender | string | âœ“ | ì„±ë³„ (MALE/FEMALE) |
| height | integer | âœ“ | í‚¤ (cm) |
| weight | number | âœ“ | ëª¸ë¬´ê²Œ (kg) |

Response (AI -> ë°±ì—”ë“œ):
- í”¼ê·¸ë§ˆ í™•ì¸ í›„ ì •ì˜
- í•„ìˆ˜ í¬í•¨: ì§„ë‹¨ ë²„í‚· (OA/OVR/TRM/INF ë“±)

#### 7.5.3 ìš´ë™ ì¶”ì²œ

Request (ë°±ì—”ë“œ -> AI)
```json
{
  "userId": 1,
  "bucket": "OA",
  "painLevel": 5,
  "squatResponse": "10ê°œ",
  "pushupResponse": "5ê°œ",
  "stepupResponse": "15ê°œ",
  "plankResponse": "30ì´ˆ",
  "birthDate": "2000-01-01",
  "gender": "MALE",
  "height": 170,
  "weight": 65,
  "previousFeedback": {
    "rpeResponse": "ì ë‹¹í•¨",
    "muscleStimulationResponse": "ì¤‘ê°„",
    "sweatResponse": "ë³´í†µ"
  }
}
```

í•„ë“œ ì„¤ëª…:
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|---|---|---|---|
| userId | integer | âœ“ | ì‚¬ìš©ì ID |
| bucket | string | âœ“ | ë²„í‚· ì¶”ë¡  ê²°ê³¼ (OA/OVR/TRM/INF) |
| painLevel | integer | âœ“ | í˜„ì¬ í†µì¦ ì •ë„ (0-10) |
| squatResponse | string | âœ“ | ìŠ¤ì¿¼íŠ¸ ê°€ëŠ¥ íšŸìˆ˜ |
| pushupResponse | string | âœ“ | í‘¸ì‹œì—… ê°€ëŠ¥ íšŸìˆ˜ |
| stepupResponse | string | âœ“ | ìŠ¤í…ì—… ê°€ëŠ¥ íšŸìˆ˜ |
| plankResponse | string | âœ“ | í”Œë­í¬ ê°€ëŠ¥ ì‹œê°„ |
| birthDate | string | âœ“ | ìƒë…„ì›”ì¼ (YYYY-MM-DD) |
| gender | string | âœ“ | ì„±ë³„ (MALE/FEMALE) |
| height | integer | âœ“ | í‚¤ (cm) |
| weight | number | âœ“ | ëª¸ë¬´ê²Œ (kg) |
| previousFeedback | object | | ì´ì „ ìš´ë™ í”¼ë“œë°± (ìµœì´ˆ ìš´ë™ ì‹œ null) |
| â””â”€ rpeResponse | string | | ìš´ë™ í›„ ëª¸ ìƒíƒœ |
| â””â”€ muscleStimulationResponse | string | | ê·¼ìœ¡ ìê·¹ ì •ë„ |
| â””â”€ sweatResponse | string | | ë•€ ë°°ì¶œëŸ‰ |

Response (AI -> ë°±ì—”ë“œ):
```json
{
  "userId": 1,
  "routineDate": "2026-01-06",
  "exercises": [
    {
      "exerciseId": "E01",
      "recommendedSets": 3,
      "recommendedReps": 10,
      "exerciseOrder": 1
    },
    {
      "exerciseId": "E02",
      "recommendedSets": 2,
      "recommendedReps": 15,
      "exerciseOrder": 2
    }
  ]
}
```

í•„ë“œ ì„¤ëª…:
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|---|---|---|---|
| userId | integer | âœ“ | ì‚¬ìš©ì ID |
| routineDate | string | âœ“ | ë£¨í‹´ ë‚ ì§œ (YYYY-MM-DD) |
| exercises | array | âœ“ | ì¶”ì²œ ìš´ë™ ëª©ë¡ (ìµœì†Œ 1ê°œ) |
| â””â”€ exerciseId | string | âœ“ | ìš´ë™ ID (DB ê¸°ì¤€) |
| â””â”€ recommendedSets | integer | âœ“ | ì¶”ì²œ ì„¸íŠ¸ ìˆ˜ |
| â””â”€ recommendedReps | integer | âœ“ | ì¶”ì²œ ë°˜ë³µ íšŸìˆ˜ |
| â””â”€ exerciseOrder | integer | âœ“ | ìš´ë™ ìˆœì„œ |

#### 7.5.4 ìš´ë™ í”¼ë“œë°± ì œì¶œ

Request (ë°±ì—”ë“œ -> AI)
```json
{
  "rpeResponse": "ì ë‹¹í•¨",
  "muscleStimulationResponse": "ì¤‘ê°„",
  "sweatResponse": "ë³´í†µ"
}
```

í•„ë“œ ì„¤ëª…:
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|---|---|---|---|
| rpeResponse | string | âœ“ | ìš´ë™ ëë‚œ í›„ ë‚´ ëª¸ì€ ì–´ë– í•œê°€ìš” |
| muscleStimulationResponse | string | âœ“ | ì˜¤ëŠ˜ ê·¼ìœ¡ì€ ì–´ë–»ê²Œ ëŠê¼ˆë‚˜ìš” |
| sweatResponse | string | âœ“ | ìš´ë™ ì¤‘ ë•€ì€ ì–´ëŠ ì •ë„ ë‚¬ë‚˜ìš” |

ì°¸ê³ : ì´ ë°ì´í„°ëŠ” ë³„ë„ ì—”ë“œí¬ì¸íŠ¸ê°€ ì•„ë‹Œ,
ë‹¤ìŒ ìš´ë™ ì¶”ì²œ Requestì˜ `previousFeedback` í•„ë“œë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

---

### 7.6 ìš´ë™ ì¶”ì²œë§Œ ì‹¤í–‰ (Gateway, Port 8000)

```bash
POST /api/v1/recommend-exercises
```

OrthoCare ë‚´ë¶€ `ExerciseRecommendationInput` ìŠ¤í‚¤ë§ˆë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.  
ì´ë¯¸ ë²„í‚· ì¶”ë¡  ê²°ê³¼ì™€ ì‚¬ì „ í‰ê°€ê°€ ìˆì„ ë•Œ í˜¸ì¶œí•˜ì„¸ìš”.

ì˜ˆì‹œ ìš”ì²­:
```json
{
  "user_id": "user_ex_001",
  "body_part": "knee",
  "bucket": "OA",
  "physical_score": { "total_score": 12 },
  "demographics": { "age": 55, "sex": "male", "height_cm": 175, "weight_kg": 80 },
  "nrs": 5
}
```

ì„ íƒ í•„ë“œ:
- `previous_assessments` (ì‚¬í›„ ì„¤ë¬¸ 3ë¬¸í•­: difficulty_felt, muscle_stimulus, sweat_level)
- `last_assessment_date`, `skipped_exercises`, `favorite_exercises`
- `joint_status` (joint_condition/rom_status/rehabilitation_phase/weight_bearing_tolerance)

ì‘ë‹µì€ `exercise_recommendation.models.output.ExerciseRecommendationOutput` ìŠ¤í‚¤ë§ˆë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.

---

## 8. ì‚¬í›„ í‰ê°€ ì‹œìŠ¤í…œ (RPE ê¸°ë°˜)

### ì‹ ì²´ ì ìˆ˜ ì‹œìŠ¤í…œ

**ì‚¬ì „ í‰ê°€ (4ë¬¸í•­, ê° 1~4ì ):**

| ë ˆë²¨ | ì ìˆ˜ ë²”ìœ„ | ìš´ë™ ê°œìˆ˜ | ë‚œì´ë„ |
|------|----------|----------|--------|
| **D** | 4-7ì  | 3ê°œ | low |
| **C** | 8-10ì  | 4ê°œ | low-medium |
| **B** | 11-13ì  | 5ê°œ | medium |
| **A** | 14-16ì  | 6ê°œ | medium-high |

### ì‚¬í›„ í‰ê°€ (RPE 3ë¬¸í•­)

| ë¬¸í•­ | ì ìˆ˜ ë²”ìœ„ | ì¡°ì • ëŒ€ìƒ |
|------|----------|----------|
| ìš´ë™ ë‚œì´ë„ ì²´ê° | 1-5 | ë‚œì´ë„, ì„¸íŠ¸ ìˆ˜ |
| ê·¼ìœ¡ ìê·¹ ì •ë„ | 1-5 | ë°˜ë³µ ìˆ˜ (ë ™) |
| ë•€ ë°°ì¶œëŸ‰ | 1-5 | ìš´ë™ ê°œìˆ˜ |

### ë‚œì´ë„ ì¡°ì • ë¡œì§

```
3ì„¸ì…˜ RPE í•©ê³„:
- í•©ê³„ â‰¤ 6: ë„ˆë¬´ ì‰¬ì›€ â†’ ë‚œì´ë„ ìƒí–¥
- í•©ê³„ 7-11: ì ì • â†’ ìœ ì§€
- í•©ê³„ â‰¥ 12: ë„ˆë¬´ í˜ë“¦ â†’ ë‚œì´ë„ í•˜í–¥
```

### AssessmentHandler ì¼€ì´ìŠ¤ ì²˜ë¦¬

```python
# ì¼€ì´ìŠ¤ë³„ ì²˜ë¦¬:
# 1. fresh_start: ìµœì´ˆ ìš´ë™ (ì‚¬ì „ í‰ê°€ë§Œ ì‚¬ìš©)
# 2. normal: ì •ìƒ ìš´ë™ (ì´ì „ ê¸°ë¡ ë°˜ì˜, 3ì„¸ì…˜ ì™„ë£Œ ì‹œ ì¡°ì •)
# 3. reset: ì˜¤ëœë§Œ (7ì¼+) ë˜ëŠ” ê¸°ë¡ ì†ì‹¤ (ë¦¬ì…‹)

handler = AssessmentHandler()
result = handler.process(
    previous_assessments=previous_assessments,
    last_assessment_date=last_date,
)
# result.status: "fresh_start" | "normal" | "reset"
```

---

## 9. ì„¤ì¹˜ ë° ì‹¤í–‰

### í™˜ê²½ ì„¤ì •

```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/3mlnssaco/Orthocare.git
cd Orthocare

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì— API í‚¤ ì…ë ¥
```

### í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜

```bash
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o
PINECONE_API_KEY=...
PINECONE_INDEX_DIAGNOSIS=orthocare-diagnosis
PINECONE_INDEX_EXERCISE=orthocare-exercise
```

ì„ íƒ í™˜ê²½ë³€ìˆ˜:
```bash
LANGSMITH_TRACING=true
LANGSMITH_ENDPOINT=https://api.smith.langchain.com
LANGSMITH_API_KEY=lsv2_...
LANGSMITH_PROJECT=orthocare
```

### Dockerë¡œ ì‹¤í–‰

```bash
# ì „ì²´ ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d

# ê°œë³„ ì„œë¹„ìŠ¤ ì‹¤í–‰
docker-compose up bucket-inference      # ë²„í‚· ì¶”ë¡ ë§Œ
docker-compose up exercise-recommendation  # ìš´ë™ ì¶”ì²œë§Œ

# ë¡œê·¸ í™•ì¸
docker-compose logs -f
```

### ë¡œì»¬ ê°œë°œ

```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python -m venv .venv
source .venv/bin/activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# ë²„í‚· ì¶”ë¡  ì„œë¹„ìŠ¤ ì‹¤í–‰
cd bucket_inference && uvicorn main:app --reload --port 8001

# ìš´ë™ ì¶”ì²œ ì„œë¹„ìŠ¤ ì‹¤í–‰ (ìƒˆ í„°ë¯¸ë„)
cd exercise_recommendation && uvicorn main:app --reload --port 8002
```

### ë²¡í„° DB ì¸ë±ì‹±

```bash
# ì§„ë‹¨ìš© ë²¡í„° DB ì¸ë±ì‹±
PYTHONPATH=. python scripts/index_diagnosis_db.py

# ìš´ë™ìš© ë²¡í„° DB ì¸ë±ì‹±
PYTHONPATH=. python scripts/index_exercise_db.py
```

---

### Railway ë°°í¬ (Gateway)

1. Railway í”„ë¡œì íŠ¸ ìƒì„± í›„ GitHub ì—°ê²°
2. Start Command ì„¤ì •:
   ```
   uvicorn gateway.main:app --host 0.0.0.0 --port $PORT
   ```
3. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ìœ„ í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ ì°¸ê³ )
4. ë°°í¬ í›„ `/health` í™•ì¸

### ë°°í¬ í…ŒìŠ¤íŠ¸

```bash
# í—¬ìŠ¤ ì²´í¬
curl https://<your-app>.up.railway.app/health

# ìë™ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
python test_railway_api.py https://<your-app>.up.railway.app
```

### ìµœì‹  ë°°í¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼

- URL: https://orthocare-production.up.railway.app
- í…ŒìŠ¤íŠ¸ ì‹œê°„: 2026-01-06 01:03 EST
- ê²°ê³¼: `/health`, `/api/v1/diagnose`, `/api/v1/recommend-exercises` ì„±ê³µ

---

## 10. í‰ê°€ ê²°ê³¼

### ìµœì‹  í‰ê°€ ê²°ê³¼ (2025-11-29)

**ì „ì²´ ì„±ëŠ¥:**
- ì´ ì¼€ì´ìŠ¤: 20ê°œ
- í†µê³¼: 19ê°œ
- ì‹¤íŒ¨: 1ê°œ
- **ì •í™•ë„: 95.0%**

**ë²„í‚·ë³„ ì •í™•ë„:**

| ë²„í‚· | ì´ ì¼€ì´ìŠ¤ | ì •í™• | ì •í™•ë„ |
|------|----------|------|--------|
| OA | 6 | 5 | 83.3% |
| OVR | 5 | 5 | 100.0% |
| TRM | 5 | 5 | 100.0% |
| INF | 2 | 2 | 100.0% |
| RED_FLAG | 2 | 2 | 100.0% |

### í…ŒìŠ¤íŠ¸ í˜ë¥´ì†Œë‚˜

| Persona | ë‚˜ì´ | ì¦ìƒ | ì˜ˆìƒ ë²„í‚· |
|---------|------|------|----------|
| 1 | 55 | ë¬´ë¦ í†µì¦, ì•„ì¹¨ ë»£ë»£í•¨, ê³„ë‹¨ ì˜¤ë¥´ê¸° ì–´ë ¤ì›€ | OA |
| 2 | 28 | ACL ë¶€ìƒ í›„ ë¶ˆì•ˆì •ê°, ìš´ë™ ì¤‘ ì†ìƒ | TRM |
| 3 | 35 | ë‹¬ë¦¬ê¸° í›„ ë¬´ë¦ ì•ìª½ í†µì¦, ì•‰ì•˜ë‹¤ ì¼ì–´ë‚  ë•Œ ì•…í™” | OVR |

---

## 11. ê¸°ìˆ  ìŠ¤íƒ

| í•­ëª© | ê¸°ìˆ  |
|------|------|
| **LLM** | OpenAI GPT-4o-mini |
| **ë²¡í„° DB** | Pinecone (3072ì°¨ì›, text-embedding-3-large) |
| **í”„ë ˆì„ì›Œí¬** | FastAPI, Pydantic |
| **ì»¨í…Œì´ë„ˆ** | Docker, Docker Compose |
| **ì–¸ì–´** | Python 3.11+ |

### ê²°ì • ì‚¬í•­

| í•­ëª© | ê²°ì • |
|------|------|
| ë¬´ë¦ ë²„í‚· ìˆ˜ | 4ê°œ (OA/OVR/TRM/INF) |
| ë²¡í„° DB | Pinecone (ì„œë²„ë¦¬ìŠ¤, 3072ì°¨ì›) |
| ì„ë² ë”© ëª¨ë¸ | text-embedding-3-large (OpenAI) |
| ìµœì†Œ ìœ ì‚¬ë„ | 0.35 (ê²€ìƒ‰ ê²°ê³¼ í•„í„°ë§) |
| OrthoBullets | í¬ë¡¤ë§ ë¶ˆê°€ â†’ ìˆ˜ë™ íë ˆì´ì…˜ |
| LLM ì¸ìš© | ê²€ìƒ‰ëœ ë¬¸ì„œë§Œ (hallucination ê¸ˆì§€) |

---

## 12. ë¬¸ì„œ

### ë¬¸ì„œ ëª©ë¡

| ë¬¸ì„œ | ëŒ€ìƒ | ì„¤ëª… |
|------|------|------|
| [docs/INDEX.md](docs/INDEX.md) | ì „ì²´ | ë¬¸ì„œ ì¸ë±ìŠ¤ |
| [docs/CHANGELOG.md](docs/CHANGELOG.md) | ì „ì²´ | ë²„ì „ë³„ ë³€ê²½ ì´ë ¥ |
| [docs/backend-integration.md](docs/backend-integration.md) | ë°±ì—”ë“œ ê°œë°œì | Gateway API í†µí•© ê°€ì´ë“œ |
| [docs/architecture/langgraph.md](docs/architecture/langgraph.md) | AI ê°œë°œì | LangGraph íŒŒì´í”„ë¼ì¸ ì„¤ê³„ |
| [docs/medical-review.md](docs/medical-review.md) | ë©”ë””ì»¬/ì¬í™œíŒ€ | ë²„í‚· ë¶„ë¥˜, ìš´ë™ ì²˜ë°© ê²€í†  |

### ì—…ë°ì´íŠ¸ ì£¼ê¸°

| ë¬¸ì„œ ìœ í˜• | ì—…ë°ì´íŠ¸ ì‹œì  |
|----------|-------------|
| README.md | ì£¼ìš” ê¸°ëŠ¥ ë³€ê²½ ì‹œ |
| CHANGELOG.md | ëª¨ë“  ë³€ê²½ ì‹œ |
| backend-integration.md | API ë³€ê²½ ì‹œ |
| medical-review.md | ì„ìƒ í”¼ë“œë°± ë°˜ì˜ ì‹œ |

---

## ë²„ì „ íˆìŠ¤í† ë¦¬

| ë²„ì „ | ë‚ ì§œ | ì„¤ëª… |
|------|------|------|
| **V3.1** | 2025-12-24 | LangGraph ë²„í‚· ì¶”ë¡ , Gateway í†µí•© |
| V3.0 | 2025-12-04 | ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë¶„ë¦¬, ë‹¤ì¤‘ ë¶€ìœ„ ì§€ì› |
| V2.0 | 2025-11-29 | ì‚¬í›„ í‰ê°€ ì‹œìŠ¤í…œ, ê°œì¸í™” ê°•í™” |
| V1.0 | 2025-11-15 | ì´ˆê¸° ë²„ì „ |

| ë¸Œëœì¹˜ | ì„¤ëª… |
|--------|------|
| `main` | V3.1 LangGraph í†µí•© (í˜„ì¬) |
| `v1-unified-model` | V1 í†µí•© íŒŒì´í”„ë¼ì¸ (ë ˆê±°ì‹œ) |

---

## ê¸°ì—¬

ì´ìŠˆ ë° PR í™˜ì˜í•©ë‹ˆë‹¤.
